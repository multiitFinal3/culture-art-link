<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.w3.org/1999/xhtml">
<html layout:decorate="~{common/layout/layoutMenubar}">
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" th:href="@{/css/user/myPage.css}">
    <script th:inline="javascript">

        $(document).ready(
            function(){

                var user = [[${user}]];

                //#region 기본정보 입력

                /**
                 * 전체 지역 정보를 가져옴
                 *
                 */
                function findAllRegion(){

                    $.ajax({

                        url: '/user/signUp/findAllRegion',
                        method: 'POST',
                        contentType: 'application/json',
                        success: function(list){

                            $('#regionId').html("");

                            $.each(list, function(index, region){

                                var htmlContent = ``;

                                if(user.regionId==region.regionId){

                                    htmlContent = `<option value="${region.regionId}" selected>${region.regionName}</option>`;

                                }else{

                                    htmlContent = `<option value="${region.regionId}">${region.regionName}</option>`;

                                }

                                $('#regionId').append(htmlContent);

                            })

                        }

                    })

                }

                findAllRegion();


                /**
                 * 성별 표시
                 *
                 */
                 function presentGender(gender){

                    $('#gender').html("");
                    var htmlContent = ``;
                    var 남 = "남";
                    var 여 = "여";

                    if(user.gender=="남"){
                        htmlContent = `<option value="남" selected>남</option><option value="여">여</option>`;
                    }else{
                        htmlContent = `<option value="남">남</option><option value="여" selected>여</option>`;
                    }

                    $('#gender').html(htmlContent);

                 }

                 presentGender(gender);



                /**
                 * 이미지 표시
                 * @param {string} img
                 */
                 function renderImg(img){

                    var htmlContent = ``;

                    if(!img || img == "null" || img==""){
                        htmlContent = `
                            <img class="profileImg" src="/img/festival/noPhoto.png" alt="이미지가 없습니다" style="width:100%;">
                        `;
                    }else{
                        htmlContent = `
                            <img class="profileImg" src="${user.userProfilePic}" alt="이미지가 없습니다" style="width:100%;">
                        `;
                    }

                    $('#profileImg').html(htmlContent);

                 }

                renderImg(user.userProfilePic);



                /**
                 * 사용자 프로필 사진 변경 시 이미지 바꾸는 이벤트
                 *
                 */
                $("input:file").change(function(){

                    var file = this.files[0];

                    if(file){

                        var reader = new FileReader();

                        reader.onload = function(e){

                            var changeSrc = e.target.result;

                            var htmlContent = ``;

                            htmlContent = `
                                <img class="profileImg" src="${changeSrc}" alt="이미지가 없습니다" style="width:100%;">
                            `;

                            $('#profileImg').html(htmlContent);


                        }

                        reader.readAsDataURL(file);

                    }
                })



                /**
                * 회원정보 삭제
                *
                */
                $(document).on('click','#deleteAccount', function(){

                    $.ajax({

                        url: '/user/deleteUserAccount',
                        method: 'POST',
                        contentType: 'application/json',
                        success: function(){
                            alert("회원 탈퇴 되었습니다.");
                            window.location = "/user/logout";
                        }
                    })
                })



                /**
                * 회원정보 수정
                *
                */
                $(document).on('submit','#basicForm', function(event){
                    console.log("#updateAccount")
                    event.preventDefault();

                    var formData = new FormData();

                    var fileInput = document.getElementById('uploadFile');
                    if(fileInput && fileInput.files.length > 0){
                        formData.append('file', fileInput.files[0]);
                    }


                    var email = document.getElementById('email').value;
                    formData.append('email', email);

                    var password = document.getElementById('password').value;
                    formData.append('password', password);

                    var userName = document.getElementById('userName').value;
                    formData.append('userName', userName);

                    var tel = document.getElementById('tel').value;
                    formData.append('tel', tel);

                    var userAge = document.getElementById('userAge').value;
                    formData.append('userAge', userAge);

                    var gender = document.getElementById('gender').options[document.getElementById('gender').selectedIndex].value;
                    formData.append('gender', gender);

                    var regionId = document.getElementById('regionId').options[document.getElementById('regionId').selectedIndex].value;
                    formData.append('regionId', regionId);

                    console.log(regionId);
                    console.log(email);

                    $.ajax({

                        url: '/user/updateUserAccount',
                        method: 'POST',
                        data: formData,
                        processData: false,
                        contentType: false,
                        success: function(){
                            alert("회원정보 수정 되었습니다.");
                            window.location = "/user/myPage";
                        },
                        error: function(xhr, status, error){

                            alert('회원정보 수정 실패');

                        }
                    })
                })

                //#endregion






                //# region 상단바 : 축제 카테고리별 찜 / 관심없음 / 리뷰 내역



                /**
                 * 축제 찜한 내역을 가져옴
                 *
                 */
                function findLoveFestivalList(){

                    $.ajax({

                        url: '/festival/findLoveFestivalList',
                        method: 'POST',
                        contentType: 'application/json',
                        success: function(list){
                            $('#upper').html("");
                            $('#upper').removeClass("page")
                            $('#upper').addClass("scroll")

                            $.each(list, function(index, festival){

                                var content = festival.festivalContent.length > 10?
                                festival.festivalContent.substring(0,10) + "..."
                                : festival.festivalContent;

                                var firstHtml= ``;

                                if(! festival.imgUrl || festival.imgUrl == "null" || festival.imgUrl == ""){

                                    firstHtml = `
                                        <div class="card" id="${festival.festivalId}">
                                            <img class="card-img-top" src="/img/festival/noPhoto.png" alt="Card image cap">

                                    `;

                                }else{

                                    firstHtml = `
                                        <div class="card" id="${festival.festivalId}">
                                            <img class="card-img-top" src="${festival.imgUrl}" alt="Card image cap">

                                    `;

                                }

                                var secondHtml = `
                                    <div class="card-body">
                                          <h5 class="card-title">${festival.festivalName}</h5>
                                          <p class="card-text">${content}</p>
                                          <a href="/festival/festival-detail?festivalId=${festival.festivalId}" class="btn btn-primary">자세히</a>
                                           <button class="btn btn-primary heart" type="button" style="margin:0px" value="${festival.festivalId}">
                                              <img src="/img/festival/heart.png"
                                                   style="width : 20px; height: 20px;">
                                          </button>
                                          <button class="btn btn-primary hate" type="button" style="margin:0px" value="${festival.festivalId}">
                                                <img src="/img/festival/trash.png"
                                                     style="width : 20px; height: 20px;">
                                          </button>
                                    </div>

                                </div>
                                `;

                                var finalHtml = firstHtml + secondHtml;

                                $('#upper').append(finalHtml);

                                findLoveList();
                                findHateList();


                            })
                        }

                    })

                }

                findLoveFestivalList();



                /**
                 * 축제 관심없음한 내역을 가져옴
                 *
                 */
                function findHateFestivalList(){

                    $.ajax({

                        url: '/festival/findHateFestivalList',
                        method: 'POST',
                        contentType: 'application/json',
                        success: function(list){

                            $('#upper').html("");
                            $('#upper').removeClass("page")
                            $('#upper').addClass("scroll")

                            $.each(list, function(index, festival){

                                var content = festival.festivalContent.length > 10?
                                festival.festivalContent.substring(0,10) + "..."
                                : festival.festivalContent;

                                var firstHtml= ``;

                                if(! festival.imgUrl || festival.imgUrl == "null"){

                                    firstHtml = `
                                        <div class="card" id="${festival.festivalId}">
                                            <img class="card-img-top" src="/img/festival/noPhoto.png" alt="Card image cap">

                                    `;

                                }else{

                                    firstHtml = `
                                        <div class="card" id="${festival.festivalId}">
                                            <img class="card-img-top" src="${festival.imgUrl}" alt="Card image cap">

                                    `;

                                }

                                var secondHtml = `
                                    <div class="card-body">
                                          <h5 class="card-title">${festival.festivalName}</h5>
                                          <p class="card-text">${content}</p>
                                          <a href="/festival/festival-detail?festivalId=${festival.festivalId}" class="btn btn-primary">자세히</a>
                                           <button class="btn btn-primary heart" type="button" style="margin:0px" value="${festival.festivalId}">
                                              <img src="/img/festival/heart.png"
                                                   style="width : 20px; height: 20px;">
                                          </button>
                                          <button class="btn btn-primary hate" type="button" style="margin:0px" value="${festival.festivalId}">
                                                <img src="/img/festival/trash.png"
                                                     style="width : 20px; height: 20px;">
                                          </button>
                                    </div>

                                </div>
                                `;

                                var finalHtml = firstHtml + secondHtml;

                                $('#upper').append(finalHtml);

                                findLoveList();
                                findHateList();


                            })
                        }

                    })

                }


                /**
                * 찜하기 / 찜 취소하기 버튼
                *
                */
                $(document).on('click','.heart', function(){

                    var button = $(this);
                    var festivalId = $(this).val();

                    if(button.closest(".card").hasClass("hasLove")){

                        $.ajax({

                            url: '/festival/deleteUserLoveFestival?festivalId=' + festivalId,
                            method: 'POST',
                            contentType: 'application/json',
                            success: function(res){
                                alert(res);
                                button.closest('.card').removeClass("hasLove");
                                findLoveFestivalList();
                            },
                            error: function(xhr, status, error){

                                alert('error : ',error);

                            }
                        })

                    }else{

                        if(button.closest(".card").hasClass("hasHate")){
                            button.closest(".card").find(".hate").click();
                        }


                        $.ajax({

                            url: '/festival/insertUserLoveFestival?festivalId=' + festivalId,
                            method: 'POST',
                            contentType: 'application/json',
                            success: function(res){

                                alert(res);
                                button.closest(".card").addClass("hasLove");
                                findLoveFestivalList();


                            },
                            error: function(xhr, status, error){

                             alert('error : ',error);

                            }

                        })


                    }

                })


                /**
                * 찜 리스트 찾아서 색 바꾸기
                *
                */
                function findLoveList(){

                    var cardList = document.querySelectorAll(".card");

                    $.ajax({

                        url: '/festival/findLoveList',
                        method: 'POST',
                        contentType: 'application/json',
                        success: function(list){

                            $.each(cardList, function(index, card){

                                var cardString = card.getAttribute('id');
                                var cardInt = parseInt(cardString, 10);

                                if(list.includes(cardInt)){

                                    $(card).addClass("hasLove");

                                }
                            })
                        }
                    })

                }




               /**
                * 관심없음 하기 / 관심없음 취소하기 버튼
                *
                */
                $(document).on('click','.hate', function(){

                    var button = $(this);
                    var festivalId = $(this).val();

                    if(button.closest(".card").hasClass("hasHate")){

                        $.ajax({

                            url: '/festival/deleteUserHateFestival?festivalId=' + festivalId,
                            method: 'POST',
                            contentType: 'application/json',
                            success: function(res){
                                alert(res);
                                button.closest('.card').removeClass("hasHate");
                            },
                            error: function(xhr, status, error){

                                alert('error : ',error);

                            }
                        })

                    }else{

                        if(button.closest(".card").hasClass("hasLove")){
                            button.closest(".card").find(".heart").click();
                        }

                        $.ajax({

                            url: '/festival/insertUserHateFestival?festivalId=' + festivalId,
                            method: 'POST',
                            contentType: 'application/json',
                            success: function(res){

                                alert(res);
                                button.closest(".card").addClass("hasHate");
                                findHateFestivalList();


                            },
                            error: function(xhr, status, error){

                             alert('error : ',error);

                            }
                        })
                    }

                })


                /**
                * 관심없음 리스트 찾아서 색 바꾸기
                *
                */
                function findHateList(){

                    var cardList = document.querySelectorAll(".card");

                    $.ajax({

                        url: '/festival/findHateList',
                        method: 'POST',
                        contentType: 'application/json',
                        success: function(list){

                            $.each(cardList, function(index, card){

                                var cardString = card.getAttribute('id');
                                var cardInt = parseInt(cardString, 10);

                                if(list.includes(cardInt)){

                                    $(card).addClass("hasHate");

                                }
                            })
                        }
                    })

                }

                /**
                 * 전체 축제 리뷰 내역을 가져옴(페이지 별로)
                 *
                 */
                function findFestivalReviewListByPage(page){

                    $.ajax({

                        url: '/festival/findFestivalReviewListByUserId?page='+page,
                        method: 'POST',
                        contentType: 'application/json',
                        success: function(list){
                            $('#upper').html("");
                            $('#upper').removeClass("scroll")
                            $('#upper').addClass("page")

                            console.log("리뷰" + list)

                            var reviewHeader = `

                                <table class="table table-striped" id="reviewTable" style="text-align: center;">

                                    <thead class="table-light">
                                    <tr style="text-align: center;">
                                        <th scope="col" style="width: 300px;">#</th>
                                        <th scope="col" style="width: 900px;">별점 / 내용</th>
                                        <th scope="col" style="width: 300px;">첨부파일</th>
                                        <th scope="col" style="width: 150px;">수정</th>
                                        <th scope="col" style="width: 150px;">삭제</th>
                                    </tr>
                                    </thead>
                                    <tbody id="reviewList">

                            `;

                            $('#upper').html(reviewHeader);

                            $.each(list, function(index, review){

                                var index1 = (page-1)*5 + index+1;
                                var reviewHtml = ``;
                                var attachment = ``;
                                var reviewUserId = review.userId;
                                var festivalId = review.festivalId;


                                if((review.attachment == null) || (review.attachment == "")){

                                    attachment = `
                                    <td style="width: 300px;">
                                        <img src="/img/festival/noPhoto.png" style="width:100%;display: block;">
                                    </td>
                                    `

                                }else{

                                    attachment = `
                                    <td style="width: 300px;">
                                        <img src="${review.attachment}" alt="사진 없음" style="width:100%;height:100%;display: block;">
                                    </td>
                                    `

                                }

                                 reviewHtml = `

                                    <tr class="reviewRow" id="reviewRow">

                                        <td class="index1" style="width: 300px;">
                                            ${index1}
                                        </td>`

                                        +

                                        `
                                       <td style="width: 900px">
                                            <form id="reviewForm_${review.festivalReviewId}" style="width: 100%;display: flex;flex-flow: column;align-items: center;justify-content: center;">
                                                <div class="star-rating2" style="width: 100%;display: flex;justify-content: center;">
                                                    <input type="radio" id="star5_${review.festivalReviewId}" name="reviewStar" value="5" ${review.festivalReviewStar == 5? 'checked' : ''}/>
                                                    <label for="star5_${review.festivalReviewId}">★</label>
                                                    <input type="radio" id="star4_${review.festivalReviewId}" name="reviewStar" value="4" ${review.festivalReviewStar == 4? 'checked' : ''}/>
                                                    <label for="star4_${review.festivalReviewId}">★</label>
                                                    <input type="radio" id="star3_${review.festivalReviewId}" name="reviewStar" value="3" ${review.festivalReviewStar == 3? 'checked' : ''}/>
                                                    <label for="star3_${review.festivalReviewId}">★</label>
                                                    <input type="radio" id="star2_${review.festivalReviewId}" name="reviewStar" value="2" ${review.festivalReviewStar == 2? 'checked' : ''}/>
                                                    <label for="star2_${review.festivalReviewId}">★</label>
                                                    <input type="radio" id="star1_${review.festivalReviewId}" name="reviewStar" value="1" ${review.festivalReviewStar == 1? 'checked' : ''}/>
                                                    <label for="star1_${review.festivalReviewId}">★</label>
                                                </div>
                                                <input type="hidden" value="${review.festivalReviewId}" name="festivalReviewId">
                                                <input type="hidden" value="${festivalId}" name="festivalId">
                                                <textarea class="reviewText" rows="2" cols="100" style="text-align: center;" name="reviewText" style="max-width: 100%;">${review.festivalReviewContent}</textarea>
                                            </form>
                                            </td>`

                                        +

                                        attachment

                                        +

                                        `<td style="width: 150px;">
                                            <button class="updateBtn" value="${review.festivalReviewId}">수정</button>
                                        </td>

                                        <td style="width: 150px;">
                                            <button class="deleteBtn" value="${review.festivalReviewId}">삭제</button>
                                        </td>

                                    </tr>
                                 `;

                                $('#upper').append(reviewHtml);

                            })

                            var reviewFooter =  `</tbody></table>`;
                            $('#upper').append(reviewFooter);
                            findUserReviewCount();

                        }
                    })
                }




                /**
                * 유저별 전체 리뷰 페이지 버튼 만들기
                *
                *
                */
                function findUserReviewCount(){

                    $.ajax({

                        url: '/festival/findUserReviewCount',
                        method: 'POST',
                        contentType: 'application/json',
                        success: function(count){

                            $('#reviewPages').html("");

                            var reviewPagesHtml = `

                                <div id="reviewPages"><div>

                            `;

                            $('#upper').append(reviewPagesHtml);

                            var pages = 0;

                            if(count % 5 == 0){
                                pages = count / 5;
                            }else{
                                pages = count / 5 + 1;
                            }

                            for(var p=1; p<=pages; p++){

                                $('#reviewPages').append(`<button class="pageBtn1" style="font-size: 20px; margin: 0.5%">${p}</button>`)

                            }


                        }

                    })
                }


               /**
                * 리뷰 페이지 이벤트 버튼
                *
                */
                $(document).on('click','.pageBtn1', function(){

                    var page = $(this).text();
                    findFestivalReviewListByPage(page);
                    findUserReviewCount();

                })





                /**
                * 리뷰 삭제
                *
                */
                $(document).on('click','.deleteBtn', function(){

                    var festivalReviewId = $(this).val();

                    $.ajax({

                        url: '/festival/deleteFestivalReviewByReviewId?festivalReviewId=' + festivalReviewId,
                        method: 'POST',
                        contentType: 'application/json',
                        success: function(res){

                            alert(res);
                            findFestivalReviewListByPage(1);


                        }
                    })
                })




                 /**
                * 리뷰 수정
                *
                */
                $(document).on('click','.updateBtn', function(){

                    var festivalReviewId = $(this).val();
                    var formId = `#reviewForm_${festivalReviewId}`;
                    var formData = new FormData($(formId)[0]);

                    $.ajax({

                        url: '/festival/updateFestivalReview',
                        method: 'POST',
                        data: formData,
                        processData: false,
                        contentType: false,
                        success: function(res){

                            alert("리뷰 수정 성공!!");

                        }
                    })
                })








                //#endregion




                //#region 상단바 : 공연

                //#endregion


                //#region 상단바 : 전시


                /**
                 * 전시 찜한 내역을 가져옴
                 *
                 */
                function findLoveExhibitionList(){

                    console.log("findLoveExhibitionList()")

                    $.ajax({

                        url: '/exhibition/liked',
                        method: 'GET',
                        contentType: 'application/json',
                        success: function(list){
                            console.log("/exhibition/liked")
                            $('#upper').html("");
                            $('#upper').removeClass("page")
                            $('#upper').addClass("scroll")

                            $.each(list, function(index, exhibition){

                                var content = exhibition.description.length > 10?
                                exhibition.description.substring(0,10) + "..."
                                : exhibition.description;

                                var firstHtml= ``;

                                if(! exhibition.image || exhibition.image == ""){

                                    firstHtml = `
                                        <div class="card hasLove" id="${exhibition.id}">
                                            <img class="card-img-top" src="/img/festival/noPhoto.png" alt="Card image cap">

                                    `;

                                }else{

                                    firstHtml = `
                                        <div class="card hasLove" id="${exhibition.id}">
                                            <img class="card-img-top" src="${exhibition.image}" alt="Card image cap">

                                    `;

                                }

                                var secondHtml = `
                                    <div class="card-body">
                                          <h5 class="card-title">${exhibition.title}</h5>
                                          <p class="card-text">${content}</p>
                                          <a href="/exhibition/detail/${exhibition.id}" class="btn btn-primary">자세히</a>
                                           <button class="btn btn-primary heart" type="button" style="margin:0px" value="${exhibition.id}">
                                              <img src="/img/festival/heart.png"
                                                   style="width : 20px; height: 20px;">
                                          </button>
                                          <button class="btn btn-primary hate" type="button" style="margin:0px" value="${exhibition.id}">
                                                <img src="/img/festival/trash.png"
                                                     style="width : 20px; height: 20px;">
                                          </button>
                                    </div>

                                </div>
                                `;

                                var finalHtml = firstHtml + secondHtml;

                                $('#upper').append(finalHtml);

                            })
                        }

                    })

                }



                /**
                 * 전시 관심없음한 내역을 가져옴
                 *
                 */
                function findHateExhibitionList(){

                    $.ajax({

                        url: '/exhibition/unliked',
                        method: 'GET',
                        contentType: 'application/json',
                        success: function(list){

                            $('#upper').html("");
                            $('#upper').removeClass("page")
                            $('#upper').addClass("scroll")


                            $.each(list, function(index, exhibition){

                                var content = exhibition.description.length > 10?
                                exhibition.description.substring(0,10) + "..."
                                : exhibition.description;

                                var firstHtml= ``;

                                if(! exhibition.image || exhibition.image == ""){

                                    firstHtml = `
                                        <div class="card hasHate" id="${exhibition.id}">
                                            <img class="card-img-top" src="/img/festival/noPhoto.png" alt="Card image cap">

                                    `;

                                }else{

                                    firstHtml = `
                                        <div class="card hasHate" id="${exhibition.id}">
                                            <img class="card-img-top" src="${exhibition.image}" alt="Card image cap">

                                    `;

                                }

                                var secondHtml = `
                                    <div class="card-body">
                                          <h5 class="card-title">${exhibition.title}</h5>
                                          <p class="card-text">${content}</p>
                                          <a href="/exhibition/detail/${exhibition.id}" class="btn btn-primary">자세히</a>
                                           <button class="btn btn-primary heart" type="button" style="margin:0px" value="${exhibition.id}">
                                              <img src="/img/festival/heart.png"
                                                   style="width : 20px; height: 20px;">
                                          </button>
                                          <button class="btn btn-primary hate" type="button" style="margin:0px" value="${exhibition.id}">
                                                <img src="/img/festival/trash.png"
                                                     style="width : 20px; height: 20px;">
                                          </button>
                                    </div>

                                </div>
                                `;

                                var finalHtml = firstHtml + secondHtml;

                                $('#upper').append(finalHtml);

                            })

                        }

                    })
                }



                 /**
                 * 전체 전시 리뷰 내역을 가져옴(페이지 별로)
                 *
                 */
                function findExhibitionReviewListByPage(page){

                    console.log("findExhibitionReviewListByPage");

                    $.ajax({

                        url: '/exhibition/user-comment',
                        method: 'GET',
                        contentType: 'application/json',
                        success: function(list){
                            $('#upper').html("");
                            $('#upper').removeClass("scroll")
                            $('#upper').addClass("page")

                            console.log("리뷰" + list)

                            var reviewHeader = `

                                <table class="table table-striped" id="reviewTable" style="text-align: center;">

                                    <thead class="table-light">
                                    <tr style="text-align: center;">
                                        <th scope="col" style="width: 300px;">#</th>
                                        <th scope="col" style="width: 300px;">별점</th>
                                        <th scope="col" style="width: 300px;">내용</th>
                                        <th scope="col" style="width: 300px;">첨부파일</th>
                                        <th scope="col" style="width: 300px;">삭제</th>
                                    </tr>
                                    </thead>
                                    <tbody id="reviewList">

                            `;

                            $('#upper').html(reviewHeader);

                            var startIndex = (page -1)*5 + 1;
                            var endIndex = (page)*5;
                            var sliceList = list.slice(startIndex-1, endIndex);


                            console.log("sliceList");
                            console.log(sliceList);
                            $.each(sliceList, function(index, review){
                                var reviewIdPlusExhibitionId = review.id + "," + review.exhibitionId;
                                var index1 = (page-1)*5 + index+1;
                                var reviewHtml = ``;
                                var attachment = ``;

                                var content = review.content.length > 10?
                                review.content.substring(0,10) + "..."
                                : review.content;

                                var reviewStarNum = parseInt(review.stars);
                                var reviewStarHtml = ``;

                                for(let i = 1; i <= reviewStarNum; i++){
                                    var append = `
                                    <label style="color: #f6d74d;">★</label>
                                    `;
                                    reviewStarHtml += append;
                                }

                                if(reviewStarNum < 5){

                                    for(let i = reviewStarNum + 1; i <= 5; i++){

                                        var append = `
                                        <label>★</label>
                                        `;
                                        reviewStarHtml += append;

                                    }
                                }


                                if((review.attachment == null) || (review.attachment == "")){

                                    attachment = `
                                    <td style="width: 300px;">
                                        <img src="/img/festival/noPhoto.png" style="width:100%;height:100%;display: block;">
                                    </td>
                                    `

                                }else{

                                    attachment = `
                                    <td style="width: 300px;">
                                        <img src="${review.attachment}" alt="사진 없음" style="width:100%;height:100%;display: block;">
                                    </td>
                                    `

                                }

                                 reviewHtml = `

                                    <tr class="reviewRow" id="reviewRow" style="width: 100%;">

                                        <td class="index1" style="width: 300px;">
                                            ${index1}
                                        </td>`

                                        +

                                        `<td style="width: 300px;">
                                            <div class="star">`

                                                 + reviewStarHtml +

                                            `</div>
                                        </td>`
                                        +

                                        `<td style="width: 300px;">
                                            ${content}
                                        </td>`

                                        +

                                        attachment

                                        +

                                        `
                                        <td style="width: 300px;">
                                            <button class="deleteBtn2" value="${reviewIdPlusExhibitionId}">삭제</button>
                                        </td>

                                    </tr>
                                 `;

                                $('#upper').append(reviewHtml);

                            })

                            var reviewFooter =  `</tbody></table>`;
                            $('#upper').append(reviewFooter);

                            var count = list.length;
                            $('#reviewPages').html("");

                            var reviewPagesHtml = `
                                <div id="reviewPages"><div>
                            `;

                            $('#upper').append(reviewPagesHtml);

                            var pages = 0;

                            if(count % 5 == 0){
                                pages = count / 5;
                            }else{
                                pages = count / 5 + 1;
                            }

                            for(var p=1; p<=pages; p++){

                                $('#reviewPages').append(`<button class="pageBtn2" style="font-size: 20px; margin: 0.5%">${p}</button>`)

                            }

                        }
                    })
                }


               /**
                * 리뷰 페이지 이벤트 버튼
                *
                */
                $(document).on('click','.pageBtn2', function(){
                    var page = $(this).text();
                    findExhibitionReviewListByPage(page);
                })



                /**
                * 전시 리뷰 삭제
                *
                */
                $(document).on('click','.deleteBtn2', function(){

                    var reviewIdPlusExhibitionId = $(this).val().trim();
                    var ids = reviewIdPlusExhibitionId.split(",");
                    var reviewId = ids[0];
                    var exhibitionId = ids[1];

                    console.log(reviewId);
                    console.log(exhibitionId)

                    var data = {

                        id : reviewId

                    };

                    $.ajax({

                        url: `/exhibition/exhibition/${exhibitionId}/comment`,
                        method: 'DELETE',
                        contentType: 'application/json',
                        data: JSON.stringify(data),
                        success: function(){

                            alert("전시 댓글 삭제 성공");
                            findFestivalReviewListByPage(1);

                        },
                        error: function(error){

                            alert("전시 댓글 삭제 실패");

                        }
                    })
                })







                //#endregion


                //#region 상단바 : 문화제

                //#endregion


                //#region 하단바 : 축제의 찜키워드 , 관심없음 키워드


                  /**
                 * 축제 찜 키워드 중 카운트가 10개 이상인 것을 가져옴
                 *
                 */
                function findFestivalBigLoveKeyword(){

                    $.ajax({

                        url: '/festival/findFestivalBigLoveKeyword',
                        method: 'POST',
                        contentType: 'application/json',
                        success: function(list){
                            console.log("findFestivalBigLoveKeyword")
                            console.log(list);
                            $('#festivalKeywordList').html("");
                            var concat = '';
                            $.each(list, function(index, keyword){

                                var htmlContent = `<button value="${keyword.festivalKeywordId}" class="festivalLoveKeywordBtn bigLove">${keyword.festivalKeywordId}</button>`;

                                $('#festivalKeywordList').append(htmlContent);

                                concat += keyword.festivalKeywordId + " ";

                            })

                            $('#festivalKeyword').val(concat.trim()+" ");

                            findFestivalSmallLoveKeyword(1);

                        }

                    })

                }


                  /**
                 * 축제 찜 키워드 중 카운트가 10개 미만인 것을 5개씩 가져옴
                 *
                 */
                function findFestivalSmallLoveKeyword(page){

                    $.ajax({

                        url: '/festival/findFestivalSmallLoveKeyword?page='+page,
                        method: 'POST',
                        contentType: 'application/json',
                        success: function(list){
                            console.log("findFestivalSmallLoveKeyword")
                            console.log(list);
                            $.each(list, function(index, keyword){

                                var htmlContent = `<button value="${keyword.festivalKeywordId}" class="festivalLoveKeywordBtn">${keyword.festivalKeywordId}</button>`;

                                $('#festivalKeywordList').append(htmlContent);

                            })

                        }

                    })

                }


                /**
                * 축제 찜 키워드 추가 버튼
                *
                */
                $(document).on('click','#addFestivalLoveKeyword', function(){
                    var page = parseInt($(this).val());
                    page = page + 1;
                    findFestivalSmallLoveKeyword(page);
                    $(this).val(page);

                })

                findFestivalBigLoveKeyword();


                /**
                * 축제 찜 키워드 선택 시 색 변화 버튼
                *
                */
                $(document).on('click','.festivalLoveKeywordBtn', function(){

                    if($(this).hasClass('bigLove')){

                        $(this).removeClass('bigLove');

                    }else{

                        $(this).addClass('bigLove');

                    }

                    var btns = document.querySelectorAll('button.bigLove');

                    var concat = '';

                    btns.forEach(function(btn){

                        concat += (btn.value+" ");

                    })

                    $('#festivalKeyword').val(concat.trim());



                })



                  /**
                 * 축제 관심없음 키워드 중 카운트가 10개 이상인 것을 가져옴
                 *
                 */
                function findFestivalBigHateKeyword(){

                    $.ajax({

                        url: '/festival/findFestivalBigHateKeyword',
                        method: 'POST',
                        contentType: 'application/json',
                        success: function(list){
                            console.log("findFestivalBigHateKeyword")
                            console.log(list);
                            $('#festivalKeywordList').html("");
                            var concat = '';
                            $.each(list, function(index, keyword){

                                var htmlContent = `<button value="${keyword.festivalKeywordId}" class="festivalHateKeywordBtn bigHate">${keyword.festivalKeywordId}</button>`;

                                $('#festivalKeywordList').append(htmlContent);

                                concat += keyword.festivalKeywordId + " ";

                            })

                            $('#festivalKeyword').val(concat.trim()+" ");

                            findFestivalSmallHateKeyword(1);

                        }

                    })

                }


                  /**
                 * 축제 관심없음 키워드 중 카운트가 10개 미만인 것을 5개씩 가져옴
                 *
                 */
                function findFestivalSmallHateKeyword(page){

                    $.ajax({

                        url: '/festival/findFestivalSmallHateKeyword?page='+page,
                        method: 'POST',
                        contentType: 'application/json',
                        success: function(list){
                            console.log("findFestivalSmallHateKeyword")
                            console.log(list);
                            $.each(list, function(index, keyword){

                                var htmlContent = `<button value="${keyword.festivalKeywordId}" class="festivalHateKeywordBtn">${keyword.festivalKeywordId}</button>`;

                                $('#festivalKeywordList').append(htmlContent);

                            })

                        }

                    })

                }


                /**
                * 축제 관심없음 키워드 추가 버튼
                *
                */
                $(document).on('click','#addFestivalHateKeyword', function(){
                    var page = parseInt($(this).val());
                    page = page + 1;
                    findFestivalSmallHateKeyword(page);
                    $(this).val(page);

                })




                /**
                * 축제 관심없음 키워드 선택 시 색 변화 버튼
                *
                */
                $(document).on('click','.festivalHateKeywordBtn', function(){

                    if($(this).hasClass('bigHate')){

                        $(this).removeClass('bigHate');

                    }else{

                        $(this).addClass('bigHate');

                    }

                    var btns = document.querySelectorAll('button.bigHate');

                    var concat = '';

                    btns.forEach(function(btn){

                        concat += (btn.value+" ");

                    })

                    $('#festivalKeyword').val(concat.trim());



                })


                //#endregion











                //#endregion




                // #region 상단바 하단바 클릭 이벤트



                /**
                * 카테고리 드롭다운 클릭 시 텍스트를 가져옴
                *
                */
                $(document).on('click','.category', function(){

                    var categoryText = $(this).text();
                    $('#category').text(categoryText);

                    if(categoryText=="축제"){

                        findLoveFestivalList();

                    }else if(categoryText=="전시"){

                        findLoveExhibitionList();

                    }


                })




                /**
                * 찜한내역 클릭 시 카테고리에 따라 다른 내용이 채워짐
                *
                */
                $(document).on('click','#love', function(){

                    var category = $('#category').text();

                    if(category=="축제"){

                        findLoveFestivalList();

                    }else if(category=="전시"){

                        findLoveExhibitionList();

                    }

                })





                /**
                * 관심없음 내역 클릭 시 카테고리에 따라 다른 내용이 채워짐
                *
                */
                $(document).on('click','#hate', function(){

                    var category = $('#category').text();

                    if(category=="축제"){

                        findHateFestivalList();

                    }else if(category=="전시"){

                        findHateExhibitionList();

                    }

                })




                /**
                * 내가 쓴 리뷰 클릭 시 카테고리에 따라 다른 내용이 채워짐
                *
                */
                $(document).on('click','#review', function(){

                    var category = $('#category').text();

                    if(category=="축제"){

                        findFestivalReviewListByPage(1);

                    }else if(category=="전시"){

                        findExhibitionReviewListByPage(1);

                    }

                });



                /**
                * 하단바 찜 키워드 클릭 시
                *
                */
                $(document).on('click','#loveKeywordList', function(){

                    var performanceHtml = `

                        <div id="performanceKeywordList"></div>
                        <button id="addPerformanceLoveKeyword" value="1">공연 키워드 추가</button>

                    `;


                    var exhibitionHtml = `

                        <div id="exhibitionKeywordList"></div>
                        <button id="addExhibitionLoveKeyword" value="1">전시 키워드 추가</button>

                    `;


                    var festivalHtml = `

                        <div id="festivalKeywordList"></div>
                        <button id="addFestivalLoveKeyword" value="1">축제 키워드 추가</button>

                    `;


                    var culturalPropertiesHtml = `

                        <div id="culturalPropertiesKeywordList"></div>
                        <button id="addCulturalPropertiesLoveKeyword" value="1">문화재 키워드 추가</button>

                    `;

                    $('#performanceZone').html(performanceHtml);
                    $('#exhibitionZone').html(exhibitionHtml);
                    $('#festivalZone').html(festivalHtml);
                    $('#culturalPropertiesZone').html(culturalPropertiesHtml);

                    $('#festivalKeyword').val("");
                    $('#loveOrHate').val("L");
                    $('#keywordCountUpdate').text("선호 키워드 수정");


                    findFestivalBigLoveKeyword();


                });




                /**
                * 하단바 관심없음 키워드 클릭 시
                *
                */
                $(document).on('click','#hateKeywordList', function(){

                    var performanceHtml = `

                        <div id="performanceKeywordList"></div>
                        <button id="addPerformanceHateKeyword" value="1">공연 키워드 추가</button>

                    `;


                    var exhibitionHtml = `

                        <div id="exhibitionKeywordList"></div>
                        <button id="addExhibitionHateKeyword" value="1">전시 키워드 추가</button>

                    `;


                    var festivalHtml = `

                        <div id="festivalKeywordList"></div>
                        <button id="addFestivalHateKeyword" value="1">축제 키워드 추가</button>

                    `;


                    var culturalPropertiesHtml = `

                        <div id="culturalPropertiesKeywordList"></div>
                        <button id="addCulturalPropertiesHateKeyword" value="1">문화재 키워드 추가</button>

                    `;

                    $('#performanceZone').html(performanceHtml);
                    $('#exhibitionZone').html(exhibitionHtml);
                    $('#festivalZone').html(festivalHtml);
                    $('#culturalPropertiesZone').html(culturalPropertiesHtml);

                    findFestivalBigHateKeyword();
                    $('#festivalKeyword').val("");
                    $('#loveOrHate').val("H");
                    $('#keywordCountUpdate').text("비선호 키워드 수정");


                });








                //# endregion



            }
        )


    </script>
</head>
<body>

<div layout:fragment="content">

    <div id="realContent">

        <div id="leftZone">

            <form encType="multipart/form-data" id="basicForm" style="font-size: 28px;margin: 10%;">

                <div id="profileImg" style="width: 100%;">

<!--                    <img th:src="@{${user.userProfilePic}}" alt="이미지가 없습니다.">-->

                </div><br>
                프로필 사진 <input name="uploadFile" class="rounded" id="uploadFile" type="file" accept="image/*"><br>
                이메일  <input name="email" class="rounded" id="email" th:value="${user.email}" placeholder="${user.email}"><br>
                비밀번호  <input name="password" class="rounded" id="password" type="password" th:value="${user.password}" placeholder="******"><br>
                이름  <input name="userName" class="rounded" id="userName" style="width:100px;" th:value="${user.userName}" placeholder="${user.userName}">
                전화번호  <input name="tel" class="rounded" id="tel" type="tel" style="width:200px;" th:value="${user.tel}"  placeholder="${user.tel}"><br>
                나이 <input name="userAge" class="rounded" id="userAge" type="number" style="width:80px;" th:value="${user.userAge}"  th:placeholder="${user.userAge}">
                성별
                <select name="gender" class="rounded" style="width:80px;" id="gender" th:value="${user.gender}">
                </select>
                지역 <select name="regionId" id="regionId" class="rounded" style="width:100px;"></select><br>

                <button type="submit" id="updateAccount" th:value="${user.userId}">회원정보 수정</button>
                <button type="button" id="deleteAccount" th:value="${user.userId}">회원탈퇴</button>

            </form>

        </div>


        <div id="rightZone">

            <div id="upperZone">

                <ul>
                    <li class="dropdown">
                        <a href="javascript:void(0)" class="dropbtn" id="category">축제</a>
                        <div class="dropdown-content">
                            <a id="performance" class="category">공연</a>
                            <a id="exhibition" class="category">전시</a>
                            <a id="festival" class="category">축제</a>
                            <a id="culturalPro" class="category">문화제</a>
                        </div>
                    </li>
                    <li><a id="love">찜한 내역</a></li>
                    <li><a id="hate">관심없음 내역</a></li>
                    <li><a id="review">내가 쓴 리뷰</a></li>

                </ul>
                <div id="upper">

                    아아

                </div>




            </div>

            <div id="downZone">

                <ul>

                    <li><a id="loveKeywordList">찜 키워드</a></li>
                    <li><a id="hateKeywordList">관심없음 키워드</a></li>

                </ul>

                <div id="down">
                    <div id="performanceZone">
                        <div id="performanceKeywordList">
                        </div>
                        <button id="addPerformanceLoveKeyword" value="1">공연 키워드 추가</button>
                    </div>
                    <div id="exhibitionZone">
                        <div id="exhibitionKeywordList">
                        </div>
                        <button id="addExhibitionLoveKeyword" value="1">전시 키워드 추가</button>
                    </div>
                    <div id="festivalZone">
                        <div id="festivalKeywordList">
                        </div>
                        <button id="addFestivalLoveKeyword" value="1">축제 키워드 추가</button>
                    </div>
                    <div id="culturalPropertiesZone">
                        <div id="culturalPropertiesKeywordList">
                        </div>
                        <button id="addCulturalPropertiesLoveKeyword" value="1">문화재 키워드 추가</button>
                    </div>
                    <div id="updateBtnZone">
                        <form th:action="@{/user/insertUserBigLoveHateKeyword}" method="post" style="font-size: 28px;">
                            <input type="hidden" id="performanceKeyword" name="performanceKeyword">
                            <input type="hidden" id="exhibitionKeyword" name="exhibitionKeyword">
                            <input type="hidden" id="festivalKeyword" name="festivalKeyword">
                            <input type="hidden" id="culturalPropertiesKeyword" name="culturalPropertiesKeyword">
                            <input type="hidden" id="loveOrHate" name="loveOrHate" value="L">
                            <button type="submit" id="keywordCountUpdate">선호 키워드 수정</button>
                        </form>
                    </div>
                </div>

            </div>



        </div>


    </div>


</div>


</body>
</html>