<!DOCTYPE html>
<html xmlns:layout="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<html layout:decorate="~{common/layout/layoutMenubar}">
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"
          name="viewport">
    <meta content="ie=edge" http-equiv="X-UA-Compatible">
    <title>Document</title>
    <link rel="stylesheet" th:href="@{/css/user/myPage.css}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script th:inline="javascript">

        $(document).ready(
            function () {

                var user = [[${user}]];


                //#region 기본정보 입력

                /**
                 * 전체 지역 정보를 가져옴
                 *
                 */
                function findAllRegion() {

                    $.ajax({

                        url: '/user/signUp/findAllRegion',
                        method: 'POST',
                        contentType: 'application/json',
                        success: function (list) {

                            $('#regionId').html("");

                            $.each(list, function (index, region) {

                                var htmlContent = ``;

                                if (user.regionId == region.regionId) {

                                    htmlContent = `<option value="${region.regionId}" selected>${region.regionName}</option>`;

                                } else {

                                    htmlContent = `<option value="${region.regionId}">${region.regionName}</option>`;

                                }

                                $('#regionId').append(htmlContent);

                            })

                        }

                    })

                }

                findAllRegion();


                /**
                * 번호 양식 자동으로 변경
                *
                */
                document.getElementById('tel').addEventListener('blur',function(){

                    let input = this.value.replace(/\D/g,'');

                    if (input.length >11){

                        this.value = input.substring(0,11).replace(/(\d{3})(\d{4})(\d{4})/,'$1-$2-$3');

                    }else if(input.length < 11){

                        this.value = input.padEnd(11,'0').replace(/(\d{3})(\d{4})(\d{4})/,'$1-$2-$3');

                    }else{

                        this.value = input.replace(/(\d{3})(\d{4})(\d{4})/,'$1-$2-$3');

                    }

                })


                /**
                 * 성별 표시
                 *
                 */
                function presentGender(gender) {

                    $('#gender').html("");
                    var htmlContent = ``;
                    var 남 = "남";
                    var 여 = "여";

                    if (user.gender == "남") {
                        htmlContent = `<option value="남" selected>남</option><option value="여">여</option>`;
                    } else {
                        htmlContent = `<option value="남">남</option><option value="여" selected>여</option>`;
                    }

                    $('#gender').html(htmlContent);

                }

                presentGender(gender);


                /**
                 * 이미지 표시
                 * @param {string} img
                 */
                function renderImg(img) {

                    var htmlContent = ``;

                    if (!img || img == "null" || img == "") {
                        htmlContent = `
                            <img class="profileImg" src="/img/festival/noPhoto.png" alt="이미지가 없습니다">
                        `;
                    } else {
                        htmlContent = `
                            <img class="profileImg" src="${img}" alt="이미지가 없습니다">
                        `;
                    }

                    $('#profileImg').html(htmlContent);

                }

                renderImg(user.userProfilePic);


                /**
                 * 사용자 프로필 사진 변경 시 이미지 바꾸는 이벤트
                 *
                 */
                $("input:file").change(function () {

                    var file = this.files[0];

                    if (file) {

                        var reader = new FileReader();

                        reader.onload = function (e) {

                            var changeSrc = e.target.result;

                            var htmlContent = ``;

                            htmlContent = `
                                <img class="profileImg" src="${changeSrc}" alt="이미지가 없습니다">
                            `;

                            $('#profileImg').html(htmlContent);


                        }

                        reader.readAsDataURL(file);

                    }
                })


                /**
                 * 회원정보 삭제
                 *
                 */
                $(document).on('click', '#deleteAccount', function () {

                    $.ajax({

                        url: '/user/deleteUserAccount',
                        method: 'POST',
                        contentType: 'application/json',
                        success: function () {
                            alert("회원 탈퇴 되었습니다.");
                            window.location = "/user/logout";
                        }
                    })
                })


                /**
                 * 회원정보 수정
                 *
                 */
                $(document).on('submit', '#basicForm', function (event) {
                    console.log("#updateAccount")
                    event.preventDefault();

                    var formData = new FormData();

                    var fileInput = document.getElementById('uploadFile');
                    if (fileInput && fileInput.files.length > 0) {
                        formData.append('file', fileInput.files[0]);
                    }


                    var email = document.getElementById('email').value;
                    formData.append('email', email);

                    var password = document.getElementById('password').value;
                    formData.append('password', password);

                    var userName = document.getElementById('userName').value;
                    formData.append('userName', userName);

                    var tel = document.getElementById('tel').value;
                    formData.append('tel', tel);

                    var userAge = document.getElementById('userAge').value;
                    formData.append('userAge', userAge);

                    var gender = document.getElementById('gender').options[document.getElementById('gender').selectedIndex].value;
                    formData.append('gender', gender);

                    var regionId = document.getElementById('regionId').options[document.getElementById('regionId').selectedIndex].value;
                    formData.append('regionId', regionId);

                    console.log(regionId);
                    console.log(email);

                    var isEmailValid = validateSameEmail(email);

                    if (!isEmailValid) {

                        return;

                    }

                    $.ajax({

                        url: '/user/updateUserAccount',
                        method: 'POST',
                        data: formData,
                        processData: false,
                        contentType: false,
                        success: function () {
                            alert("회원정보 수정 되었습니다.");
                            window.location = "/user/myPage";
                        },
                        error: function (xhr, status, error) {

                            alert('회원정보 수정 실패');

                        }
                    })
                })


                /**
                 * 이메일 중복 검증
                 * @param {string} email 검증할 이메일
                 * @returns {boolean} 이메일이 안겹칠경우 true, 겹칠 경우 false
                 *
                 */
                function validateSameEmail(email) {
                    return new Promise((resolve, reject) => {
                        $.ajax({
                            url: '/user/validateSameEmail',
                            method: 'POST',
                            data: {
                                email: email
                            },
                            success: function (user) {

                                if (user) {

                                    alert("이메일이 존재합니다.")
                                    resolve(false);

                                } else {

                                    alert("현재 이메일을 제외하고 중복되지 않는 이메일입니다.")
                                    resolve(true);
                                }

                            },
                            error: function (xhr, status, error) {

                                alert('같은 이메일 확인 실패');
                                return (false);

                            }
                        })
                    })
                }


                /**
                 * 이메일 중복 검증 버튼
                 *
                 */
                $(document).on('click', '#emailValidate', function () {

                    event.preventDefault();
                    var email = $('#email').val();
                    validateSameEmail(email);

                })


                //#endregion


                //# region 상단바 : 축제 카테고리별 찜 / 관심없음 / 리뷰 내역


                /**
                 * 축제 카드 클릭 시 상세 페이지로 이동
                 *
                 */
                $(document).on('click', '.fcard', function () {

                    var festivalId = $(this).attr('id');
                    window.location.href = '/festival/festival-detail?festivalId=' + festivalId;

                })


                /**
                 * 축제 찜한 내역을 가져옴
                 *
                 */
                function findLoveFestivalList() {

                    $.ajax({

                        url: '/festival/findLoveFestivalList',
                        method: 'POST',
                        contentType: 'application/json',
                        success: function (list) {
                            $('#upper').html("");
                            $('#upper').removeClass("page")
                            $('#upper').addClass("scroll")

                            $.each(list, function (index, festival) {

                                var start = festival.startDate.length > 0 ?
                                    festival.startDate.substring(0, 10) :
                                    "없음";

                                var end = festival.endDate.length > 0 ?
                                    festival.endDate.substring(0, 10) :
                                    "없음";

                                var firstHtml = ``;

                                if (!festival.imgUrl || festival.imgUrl == "null") {

                                    firstHtml = `
                                        <div class="card fcard" id="${festival.festivalId}" data-value="${festival.festivalId}">
                                            <img class="card-img-top" src="/img/festival/noPhoto.png" alt="Card image cap">

                                    `;

                                } else {

                                    firstHtml = `
                                        <div class="card fcard" id="${festival.festivalId}" data-value="${festival.festivalId}">
                                            <img class="card-img-top" src="${festival.imgUrl}" alt="Card image cap">

                                    `;

                                }


                                var secondHtml = `
                                    <div class="card-body">
                                          <h5 class="card-title" title="${festival.festivalName}">${festival.festivalName}</h5>
                                          <p class="card-text" title="${festival.festivalContent}">${festival.festivalContent}</p>
                                          <p class="card-text">${start} - ${end}</p>
<!--                                          <p class="card-text t2" style="text-align:center;">★ ${festival.avgRate.toFixed(1)}</p>-->
                                          <div class="buttonZone">
                                            <button class="whiteHeartBtn">
                                                <img src="https://kr.object.ncloudstorage.com/team3/common/upNo.png"
                                                   style="width : 25px; height: 25px;" class="heart" value="${festival.festivalId}">
                                            </button>

                                            <button class="whiteHateBtn">
                                                <img src="https://kr.object.ncloudstorage.com/team3/common/downNo.png"
                                                   style="width : 25px; height: 25px;" class="hate" value="${festival.festivalId}">
                                            </button>
                                          </div>
                                    </div>

                                </div>
                                `;


                                var finalHtml = firstHtml + secondHtml;

                                $('#upper').append(finalHtml);

                                findLoveList();
                                findHateList();


                            })
                        }

                    })

                }

                findLoveFestivalList();


                /**
                 * 축제 관심없음한 내역을 가져옴
                 *
                 */
                function findHateFestivalList() {

                    $.ajax({

                        url: '/festival/findHateFestivalList',
                        method: 'POST',
                        contentType: 'application/json',
                        success: function (list) {

                            $('#upper').html("");
                            $('#upper').removeClass("page")
                            $('#upper').addClass("scroll")

                            $.each(list, function (index, festival) {

                                var start = festival.startDate.length > 0 ?
                                    festival.startDate.substring(0, 10) :
                                    "없음";

                                var end = festival.endDate.length > 0 ?
                                    festival.endDate.substring(0, 10) :
                                    "없음";

                                var firstHtml = ``;

                                if (!festival.imgUrl || festival.imgUrl == "null") {

                                    firstHtml = `
                                        <div class="card fcard" id="${festival.festivalId}" data-value="${festival.festivalId}">
                                            <img class="card-img-top" src="/img/festival/noPhoto.png" alt="Card image cap">

                                    `;

                                } else {

                                    firstHtml = `
                                        <div class="card fcard" id="${festival.festivalId}" data-value="${festival.festivalId}">
                                            <img class="card-img-top" src="${festival.imgUrl}" alt="Card image cap">

                                    `;

                                }


                                var secondHtml = `
                                    <div class="card-body">
                                          <h5 class="card-title" title="${festival.festivalName}">${festival.festivalName}</h5>
                                          <p class="card-text" title="${festival.festivalContent}">${festival.festivalContent}</p>
                                          <p class="card-text">${start} - ${end}</p>
<!--                                          <p class="card-text t2" style="text-align:center;">★ ${festival.avgRate.toFixed(1)}</p>-->
                                          <div class="buttonZone">
                                            <button class="whiteHeartBtn">
                                                <img src="https://kr.object.ncloudstorage.com/team3/common/upNo.png"
                                                   style="width : 25px; height: 25px;" class="heart" value="${festival.festivalId}">
                                            </button>

                                            <button class="whiteHateBtn">
                                                <img src="https://kr.object.ncloudstorage.com/team3/common/downNo.png"
                                                   style="width : 25px; height: 25px;" class="hate" value="${festival.festivalId}">
                                            </button>
                                          </div>
                                    </div>

                                </div>
                                `;


                                var finalHtml = firstHtml + secondHtml;


                                $('#upper').append(finalHtml);

                                findLoveList();
                                findHateList();


                            })
                        }

                    })

                }


                /**
                 * 찜하기 / 찜 취소하기 버튼
                 *
                 */
                $(document).on('click', '.heart', function (e) {

                    e.stopImmediatePropagation();


                    var img = $(this);
                    var festivalId = img.attr('value');

                    if (img.closest(".card").hasClass("hasLove")) {

                        $.ajax({

                            url: '/festival/deleteUserLoveFestival?festivalId=' + festivalId,
                            method: 'POST',
                            contentType: 'application/json',
                            success: function (res) {
                                alert(res);
                                $('#love').click();
                            },
                            error: function (xhr, status, error) {

                                alert('error : ', error);

                            }
                        })

                    } else {

                        if (img.closest(".card").hasClass("hasHate")) {
                            img.closest(".card").find(".hate").click();
                        }


                        $.ajax({

                            url: '/festival/insertUserLoveFestival?festivalId=' + festivalId,
                            method: 'POST',
                            contentType: 'application/json',
                            success: function (res) {

                                alert(res);
                                $('#love').click();

                            },
                            error: function (xhr, status, error) {

                                alert('error : ', error);

                            }

                        })


                    }


                })


                /**
                 * 찜 리스트 찾아서 색 바꾸기
                 *
                 */
                function findLoveList() {

                    var cardList = document.querySelectorAll(".fcard");

                    $.ajax({

                        url: '/festival/findLoveList',
                        method: 'POST',
                        contentType: 'application/json',
                        success: function (list) {

                            $.each(cardList, function (index, card) {

                                var cardString = card.getAttribute('data-value');
                                console.log(cardString);
                                var cardInt = parseInt(cardString, 10);

                                if (list.includes(cardInt)) {

                                    $(card).addClass("hasLove");
                                    var heartImg = $(card).find('.heart');
                                    heartImg.attr('src', 'https://kr.object.ncloudstorage.com/team3/common/upBlue.png')

                                } else {

                                    var heartImg = $(card).find('.heart');
                                    heartImg.attr('src', 'https://kr.object.ncloudstorage.com/team3/common/upNo.png');
                                }
                            })
                        }
                    })

                }


                /**
                 * 관심없음 하기 / 관심없음 취소하기 버튼
                 *
                 */
                $(document).on('click', '.hate', function (e) {

                    e.stopImmediatePropagation();

                    var img = $(this);
                    var festivalId = img.attr('value');

                    if (img.closest(".card").hasClass("hasHate")) {

                        $.ajax({

                            url: '/festival/deleteUserHateFestival?festivalId=' + festivalId,
                            method: 'POST',
                            contentType: 'application/json',
                            success: function (res) {
                                alert(res);
                                $('#hate').click();

                            },
                            error: function (xhr, status, error) {

                                alert('error : ', error);

                            }
                        })

                    } else {

                        if (img.closest(".card").hasClass("hasLove")) {
                            img.closest(".card").find(".heart").click();
                        }

                        $.ajax({

                            url: '/festival/insertUserHateFestival?festivalId=' + festivalId,
                            method: 'POST',
                            contentType: 'application/json',
                            success: function (res) {

                                alert(res);
                                $('#hate').click();


                            },
                            error: function (xhr, status, error) {

                                alert('error : ', error);

                            }

                        })


                    }

                })


                /**
                 * 관심없음 리스트 찾아서 색 바꾸기
                 *
                 */
                function findHateList() {

                    var cardList = document.querySelectorAll(".fcard");

                    $.ajax({

                        url: '/festival/findHateList',
                        method: 'POST',
                        contentType: 'application/json',
                        success: function (list) {

                            $.each(cardList, function (index, card) {

                                var cardString = card.getAttribute('data-value');
                                console.log(cardString);
                                var cardInt = parseInt(cardString, 10);

                                if (list.includes(cardInt)) {

                                    $(card).addClass("hasHate");
                                    var heartImg = $(card).find('.hate');
                                    heartImg.attr('src', 'https://kr.object.ncloudstorage.com/team3/common/downRed.png')

                                } else {

                                    var heartImg = $(card).find('.hate');
                                    heartImg.attr('src', 'https://kr.object.ncloudstorage.com/team3/common/downNo.png');
                                }

                            })
                        }
                    })

                }

                /**
                 * 전체 축제 리뷰 내역을 가져옴(페이지 별로)
                 *
                 */
                function findFestivalReviewListByPage(page) {

                    $.ajax({

                        url: '/festival/findFestivalReviewListByUserId?page=' + page,
                        method: 'POST',
                        contentType: 'application/json',
                        success: function (list) {

                            $('#upper').html("");
                            $('#upper').removeClass("scroll");
                            $('#upper').addClass("page");

                            console.log("리뷰" + list);


                            var reviewHeadHtml = `

                                <div id="reviewListHead">

                                    <div id="leftHead">
                                        <h2 style="display: inline-block;">리뷰</h2>

                                        <div id="totalReviewCount" class="mt-3" style="display: inline-block; margin-left: 10px;">
                                            숫자
                                        </div>
                                    </div>

                                    <div id="reviewList">

                                    </div>

                                    <div id="reviewPages">

                                    </div>

                                </div>

                            `;

                            $('#upper').append(reviewHeadHtml);


                            $.each(list, function (index, review) {

                                var reviewHtml = ``;
                                var profilePic = ``;
                                var attachment = ``;
                                var actionBtns = ``;
                                var reviewStarHtml = ``;
                                var reviewUserId = review.userId;
                                var reviewStarNum = review.festivalReviewStar;
                                var time = review.updatedAt.replace("T", " ").slice(0, 19);

                                if ((review.userProfilePic == null) || (review.userProfilePic == "")) {
                                    profilePic = `<img src="https://kr.object.ncloudstorage.com/team3/common/noPhoto.png" alt="이미지 없음">`;
                                } else {
                                    profilePic = `<img src="${review.userProfilePic}">`;
                                }

                                if ((review.attachment == null) || (review.attachment == "")) {
                                    attachment = `<img src="https://kr.object.ncloudstorage.com/team3/common/noPhoto.png">`
                                } else {
                                    attachment = `<img src="${review.attachment}">`
                                }


                                actionBtns = `
                                    <div class="review-actions">
                                        <button class="update btn btn-outline-success" onclick="location.href='/festival/festival-detail?festivalId=${review.festivalId}'">상세</button>
                                        <button class="update btn btn-outline-success" value="${review.festivalReviewId}" type="button">수정</button>
                                        <button class="deleteBtn btn btn-outline-success" value="${review.festivalReviewId}">삭제</button>
                                        <button class="editBtn hide btn btn-outline-success" value="${review.festivalReviewId}">저장</button>
                                        <button class="cancelBtn hide btn btn-outline-success" value="${review.festivalReviewId}">취소</button>
                                    </div>
                                `;


                                for (let i = 1; i <= reviewStarNum; i++) {
                                    var append = `
                                    <label class="goldStar">★</label>
                                    `;
                                    reviewStarHtml += append;
                                }

                                if (reviewStarNum < 5) {
                                    for (let i = reviewStarNum + 1; i <= 5; i++) {
                                        var append = `
                                        <label class="emptyStar">★</label>
                                        `;
                                        reviewStarHtml += append;
                                    }
                                }


                                reviewHtml = `

                                    <div class="review">

                                        <div class="user-info">

                                            ${profilePic}

                                            <div class="user-details">

                                                <span>${review.userName}</span>

                                                <span>${time}</span>

                                                <div class="review-rating" data-rating="${reviewStarNum}">
                                                    ${reviewStarHtml}
                                                </div>

                                            </div>

                                        </div>


                                        <div class="review-content">
                                            <p class="review-content-p-${review.festivalReviewId} review-content-p">${review.festivalReviewContent}</p>
                                            <div class="review-text-container hide">
                                                <form id="reviewForm_${review.festivalReviewId}" style="width:100%;">
                                                    <div class="star-rating2" style="width:100%;">
                                                        <input type="radio" id="star5_${review.festivalReviewId}" name="reviewStar" value="5" ${review.festivalReviewStar == 5 ? 'checked' : ''}/>
                                                        <label for="star5_${review.festivalReviewId}">★</label>
                                                        <input type="radio" id="star4_${review.festivalReviewId}" name="reviewStar" value="4" ${review.festivalReviewStar == 4 ? 'checked' : ''}/>
                                                        <label for="star4_${review.festivalReviewId}">★</label>
                                                        <input type="radio" id="star3_${review.festivalReviewId}" name="reviewStar" value="3" ${review.festivalReviewStar == 3 ? 'checked' : ''}/>
                                                        <label for="star3_${review.festivalReviewId}">★</label>
                                                        <input type="radio" id="star2_${review.festivalReviewId}" name="reviewStar" value="2" ${review.festivalReviewStar == 2 ? 'checked' : ''}/>
                                                        <label for="star2_${review.festivalReviewId}">★</label>
                                                        <input type="radio" id="star1_${review.festivalReviewId}" name="reviewStar" value="1" ${review.festivalReviewStar == 1 ? 'checked' : ''}/>
                                                        <label for="star1_${review.festivalReviewId}">★</label>
                                                    </div>
                                                    <input type="hidden" value="${review.festivalReviewId}" name="festivalReviewId">
                                                    <input type="hidden" value="${review.festivalId}" name="festivalId">
                                                    <textarea class="reviewText" name="reviewText" id="editContent-${review.festivalReviewId}" rows="5" value="${review.festivalReviewContent}">${review.festivalReviewContent}</textarea>
                                                </form>
                                            </div>
                                        </div>


                                        ${actionBtns}

                                    </div>

                                `;

                                $('#reviewList').append(reviewHtml);

                            })

                            findUserReviewCount();

                        }
                    })
                }


                /**
                 * 유저별 전체 리뷰 페이지 버튼 만들기
                 *
                 *
                 */
                function findUserReviewCount() {

                    $.ajax({

                        url: '/festival/findUserReviewCount',
                        method: 'POST',
                        contentType: 'application/json',
                        success: function (count) {

                            $('#totalReviewCount').html(count);

                            var pages = 0;

                            if (count % 5 == 0) {
                                pages = count / 5;
                            } else {
                                pages = count / 5 + 1;
                            }

                            for (var p = 1; p <= pages; p++) {

                                $('#reviewPages').append(`<button class="pageBtn1" style="font-size: 20px; margin: 0.5%">${p}</button>`)

                            }


                        }

                    })
                }


                /**
                 * 리뷰 페이지 이벤트 버튼
                 *
                 */
                $(document).on('click', '.pageBtn1', function () {

                    var page = $(this).text();
                    findFestivalReviewListByPage(page);

                    setTimeout(function () {
                        console.log("0.1s");
                        var btns = $('.pageBtn1');

                        console.log(btns)

                        btns.each(function () {

                            var button = $(this);
                            console.log(button);
                            if (button.text() == page) {
                                console.log(button.text());
                                console.log("same")
                                button.addClass('activePage');

                            } else {
                                console.log(button.text());
                                button.removeClass('activePage');

                            }
                        })
                    }, 100);
                })


                /**
                 * 리뷰 내역을 수정 가능하게 만들기
                 */
                $(document).on('click', '.update', function () {

                    var thisBtn = $(this);
                    thisBtn.addClass("hide");
                    thisBtn.siblings(".editBtn").removeClass("hide");
                    thisBtn.siblings(".cancelBtn").removeClass("hide");

                    thisBtn.parent().siblings(".review-content").find(".review-text-container").removeClass("hide");
                    thisBtn.parent().siblings(".review-content").find(".review-content-p").addClass("hide");
                    thisBtn.parent().siblings(".user-info").find(".review-rating").addClass("hide");
                })


                /**
                 * 리뷰 내역 수정 취소 버튼
                 */
                $(document).on('click', '.cancelBtn', function () {

                    var thisBtn = $(this);
                    thisBtn.addClass("hide");
                    thisBtn.siblings(".update").removeClass("hide");
                    thisBtn.siblings(".editBtn").addClass("hide");
                    thisBtn.siblings(".cancelBtn").removeClass("hide");

                    thisBtn.parent().siblings(".review-content").find(".review-text-container").addClass("hide");
                    thisBtn.parent().siblings(".review-content").find(".review-content-p").removeClass("hide");
                    thisBtn.parent().siblings(".user-info").find(".review-rating").removeClass("hide");
                })


                /**
                 * 리뷰 삭제
                 *
                 */
                $(document).on('click', '.deleteBtn', function () {

                    var festivalReviewId = $(this).val();

                    $.ajax({

                        url: '/festival/deleteFestivalReviewByReviewId?festivalReviewId=' + festivalReviewId,
                        method: 'POST',
                        contentType: 'application/json',
                        success: function (res) {

                            alert(res);
                            findFestivalReviewListByPage(1);


                        }
                    })
                })


                /**
                 * 리뷰 수정
                 *
                 */
                $(document).on('click', '.editBtn', function () {

                    var festivalReviewId = $(this).val();
                    var formId = `#reviewForm_${festivalReviewId}`;
                    var formData = new FormData($(formId)[0]);

                    $.ajax({

                        url: '/festival/updateFestivalReview',
                        method: 'POST',
                        data: formData,
                        processData: false,
                        contentType: false,
                        success: function (res) {

                            alert("리뷰 수정 성공!!");
                            findFestivalReviewListByPage(1);
                        }
                    })
                })


                //#endregion


                //#region 상단바 : 공연

                //#endregion


                //#region 상단바 : 전시

                /**
                 * 전시 카드 클릭 시 상세 페이지로 이동
                 *
                 */
                $(document).on('click', '.ecard', function () {

                    var exhibitionId = $(this).attr('id');
                    window.location.href = '/exhibition/detail/' + exhibitionId;

                })


                /**
                 * 전시 찜한 내역을 가져옴
                 *
                 */
                function findLoveExhibitionList() {

                    console.log("findLoveExhibitionList()")

                    $.ajax({

                        url: '/exhibition/liked',
                        method: 'GET',
                        contentType: 'application/json',
                        success: function (list) {
                            console.log("/exhibition/liked")
                            $('#upper').html("");
                            $('#upper').removeClass("page")
                            $('#upper').addClass("scroll")

                            $.each(list, function (index, exhibition) {

                                var start = exhibition.startDate.length > 0 ?
                                    exhibition.startDate.substring(0, 10) :
                                    "없음";

                                var end = exhibition.endDate.length > 0 ?
                                    exhibition.endDate.substring(0, 10) :
                                    "없음";

                                var firstHtml = ``;

                                if (!exhibition.image || exhibition.image == "") {

                                    firstHtml = `
                                        <div class="card hasLove ecard" id="${exhibition.id}" data-value="${exhibition.id}">
                                            <img class="card-img-top" src="/img/festival/noPhoto.png" alt="Card image cap">

                                    `;

                                } else {

                                    firstHtml = `
                                        <div class="card hasLove ecard" id="${exhibition.id}" data-value="${exhibition.id}">
                                            <img class="card-img-top" src="${exhibition.image}" alt="Card image cap">

                                    `;

                                }


                                var secondHtml = `
                                    <div class="card-body">
                                          <h5 class="card-title" title="${exhibition.title}">${exhibition.title}</h5>
                                          <p class="card-text" title="${exhibition.description}">${exhibition.description}</p>
                                          <p class="card-text">${start} - ${end}</p>
                                          <div class="buttonZone">
                                            <button class="whiteHeartBtn">
                                                <img src="https://kr.object.ncloudstorage.com/team3/common/upBlue.png"
                                                   style="width : 25px; height: 25px;" class="eheart" value="${exhibition.id}">
                                            </button>

                                            <button class="whiteHateBtn">
                                                <img src="https://kr.object.ncloudstorage.com/team3/common/downNo.png"
                                                   style="width : 25px; height: 25px;" class="ehate" value="${exhibition.id}">
                                            </button>
                                          </div>
                                    </div>

                                </div>
                                `;


                                var finalHtml = firstHtml + secondHtml;

                                $('#upper').append(finalHtml);

                            })
                        }

                    })

                }


                /**
                 * 전시 관심없음한 내역을 가져옴
                 *
                 */
                function findHateExhibitionList() {

                    $.ajax({

                        url: '/exhibition/unliked',
                        method: 'GET',
                        contentType: 'application/json',
                        success: function (list) {

                            $('#upper').html("");
                            $('#upper').removeClass("page")
                            $('#upper').addClass("scroll")


                            $.each(list, function (index, exhibition) {

                                var start = exhibition.startDate.length > 0 ?
                                    exhibition.startDate.substring(0, 10) :
                                    "없음";

                                var end = exhibition.endDate.length > 0 ?
                                    exhibition.endDate.substring(0, 10) :
                                    "없음";

                                var firstHtml = ``;

                                if (!exhibition.image || exhibition.image == "") {

                                    firstHtml = `
                                        <div class="card hasLove ecard" id="${exhibition.id}" data-value="${exhibition.id}">
                                            <img class="card-img-top" src="/img/festival/noPhoto.png" alt="Card image cap">

                                    `;

                                } else {

                                    firstHtml = `
                                        <div class="card hasLove ecard" id="${exhibition.id}" data-value="${exhibition.id}">
                                            <img class="card-img-top" src="${exhibition.image}" alt="Card image cap">

                                    `;

                                }


                                var secondHtml = `
                                    <div class="card-body">
                                          <h5 class="card-title" title="${exhibition.title}">${exhibition.title}</h5>
                                          <p class="card-text" title="${exhibition.description}">${exhibition.description}</p>
                                          <p class="card-text">${start} - ${end}</p>
                                          <div class="buttonZone">
                                            <button class="whiteHeartBtn">
                                                <img src="https://kr.object.ncloudstorage.com/team3/common/upNo.png"
                                                   style="width : 25px; height: 25px;" class="eheart" value="${exhibition.id}">
                                            </button>

                                            <button class="whiteHateBtn">
                                                <img src="https://kr.object.ncloudstorage.com/team3/common/downRed.png"
                                                   style="width : 25px; height: 25px;" class="ehate" value="${exhibition.id}">
                                            </button>
                                          </div>
                                    </div>

                                </div>
                                `;

                                var finalHtml = firstHtml + secondHtml;

                                $('#upper').append(finalHtml);

                            })

                        }

                    })
                }


                /**
                 * 전시 찜하기 / 찜 취소하기 버튼
                 *
                 */
                $(document).on('click', '.eheart', function (e) {

                    e.stopImmediatePropagation();
                    var img = $(this);
                    var exhibitionId = img.attr('value');
                    var state = "interested";

                    var rData = {
                        exhibitionId: exhibitionId,
                        state: state
                    };

                    $.ajax({
                        url: '/exhibition/interested',
                        method: 'POST',
                        data: JSON.stringify(rData),
                        contentType: 'application/json',
                        success: function () {
                            $('#love').click();
                        },
                        error: function (xhr, status, error) {
                            alert('error : ', error);
                        }
                    })

                })


                /**
                 * 전시 관심없음 하기 / 관심없음 취소하기 버튼
                 *
                 */
                $(document).on('click', '.ehate', function (e) {

                    e.stopImmediatePropagation();
                    var img = $(this);
                    var exhibitionId = img.attr('value');
                    var state = "not_interested";

                    var rData = {
                        exhibitionId: exhibitionId,
                        state: state
                    };

                    $.ajax({
                        url: '/exhibition/interested',
                        method: 'POST',
                        data: JSON.stringify(rData),
                        contentType: 'application/json',
                        success: function () {
                            $('#hate').click();
                        },
                        error: function (xhr, status, error) {
                            alert('error : ', error);
                        }
                    })

                })


                /**
                 * 전체 전시 리뷰 내역을 가져옴(페이지 별로)
                 *
                 */
                function findExhibitionReviewListByPage(page) {

                    console.log("findExhibitionReviewListByPage");

                    $.ajax({

                        url: '/exhibition/user-comment',
                        method: 'GET',
                        contentType: 'application/json',
                        success: function (list) {
                            $('#upper').html("");
                            $('#upper').removeClass("scroll")
                            $('#upper').addClass("page")
                            var size = list.length;

                            console.log("리뷰" + list)

                            var reviewHeader = `

                                <div id="reviewListHead">

                                    <div id="leftHead">

                                        <h2 style="display: inline-block;">리뷰</h2>

                                        <div id="totalReviewCount" class="mt-3" style="display: inline-block; margin-left: 10px;">
                                            ${size}
                                        </div>

                                    </div>

                                    <div id="reviewList">

                                    </div>

                                    <div id="reviewPages">

                                    </div>

                                </div>

                            `;

                            $('#upper').html(reviewHeader);

                            var startIndex = (page - 1) * 5 + 1;
                            var endIndex = (page) * 5;
                            var sliceList = list.slice(startIndex - 1, endIndex);

                            console.log("sliceList");
                            console.log(sliceList);

                            $.each(sliceList, function (index, review) {

                                var reviewIdPlusExhibitionId = review.id + "," + review.exhibitionId;
                                var reviewHtml = ``;
                                var profilePic = ``;
                                var actionBtns = ``;
                                var reviewStarHtml = ``;
                                var reviewStarNum = parseInt(review.stars);
                                var time = review.updatedAt.replace("T", " ");


                                if ((review.profileImage == null) || (review.profileImage == "")) {
                                    profilePic = `<img src="https://kr.object.ncloudstorage.com/team3/common/noPhoto.png" alt="이미지 없음">`;
                                } else {
                                    profilePic = `<img src="https://kr.object.ncloudstorage.com/team3${review.profileImage}">`;
                                }


                                actionBtns = `
                                    <div class="review-actions">
                                        <button class="update btn btn-outline-success" onclick="location.href='/exhibition/detail/${review.exhibitionId}'">상세</button>
                                        <button class="deleteBtn2 btn btn-outline-success" value="${reviewIdPlusExhibitionId}">삭제</button>
                                    </div>
                                `;

                                for (let i = 1; i <= reviewStarNum; i++) {
                                    var append = `
                                    <label class="goldStar">★</label>
                                    `;
                                    reviewStarHtml += append;
                                }

                                if (reviewStarNum < 5) {
                                    for (let i = reviewStarNum + 1; i <= 5; i++) {
                                        var append = `
                                        <label class="emptyStar">★</label>
                                        `;
                                        reviewStarHtml += append;
                                    }
                                }


                                reviewHtml = `

                                    <div class="review">

                                        <div class="user-info">

                                            ${profilePic}

                                            <div class="user-details">

                                                <span>${review.userName}</span>

                                                <span>${time}</span>

                                                <div class="review-rating" data-rating="${reviewStarNum}">
                                                    ${reviewStarHtml}
                                                </div>

                                            </div>

                                        </div>


                                        <div class="review-content">
                                            <p class="review-content-p-${review.id} review-content-p">${review.content}</p>
                                            <div class="review-text-container hide">
                                                <form id="reviewForm_${review.id}" style="width:100%;">
                                                    <div class="star-rating2" style="width:100%;">
                                                        <input type="radio" id="star5_${review.id}" name="reviewStar" value="5" ${review.reviewStarNum == 5 ? 'checked' : ''}/>
                                                        <label for="star5_${review.festivalReviewId}">★</label>
                                                        <input type="radio" id="star4_${review.festivalReviewId}" name="reviewStar" value="4" ${review.reviewStarNum == 4 ? 'checked' : ''}/>
                                                        <label for="star4_${review.id}">★</label>
                                                        <input type="radio" id="star3_${review.id}" name="reviewStar" value="3" ${review.reviewStarNum == 3 ? 'checked' : ''}/>
                                                        <label for="star3_${review.id}">★</label>
                                                        <input type="radio" id="star2_${review.id}" name="reviewStar" value="2" ${review.reviewStarNum == 2 ? 'checked' : ''}/>
                                                        <label for="star2_${review.id}">★</label>
                                                        <input type="radio" id="star1_${review.id}" name="reviewStar" value="1" ${review.reviewStarNum == 1 ? 'checked' : ''}/>
                                                        <label for="star1_${review.id}">★</label>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>


                                        ${actionBtns}

                                    </div>

                                `;

                                $('#reviewList').append(reviewHtml);

                            })


                            findUserEReviewCount(size);

                        }

                    })
                }


                /**
                 * 유저별 전체 리뷰 페이지 버튼 만들기
                 *
                 *
                 */
                function findUserEReviewCount(count) {

                    var pages = 0;

                    if (count % 5 == 0) {
                        pages = count / 5;
                    } else {
                        pages = count / 5 + 1;
                    }

                    for (var p = 1; p <= pages; p++) {
                        $('#reviewPages').append(`<button class="pageBtn2" style="font-size: 20px; margin: 0.5%">${p}</button>`)
                    }

                }


                /**
                 * 리뷰 페이지 이벤트 버튼
                 *
                 */
                $(document).on('click', '.pageBtn2', function () {
                    var page = $(this).text();
                    findExhibitionReviewListByPage(page);

                    setTimeout(function () {
                        console.log("0.1s");
                        var btns = $('.pageBtn2');

                        console.log(btns)

                        btns.each(function () {

                            var button = $(this);
                            console.log(button);
                            if (button.text() == page) {
                                console.log(button.text());
                                console.log("same")
                                button.addClass('activePage');

                            } else {
                                console.log(button.text());
                                button.removeClass('activePage');

                            }
                        })
                    }, 100);


                })


                /**
                 * 전시 리뷰 삭제
                 *
                 */
                $(document).on('click', '.deleteBtn2', function () {

                    var reviewIdPlusExhibitionId = $(this).val().trim();
                    var ids = reviewIdPlusExhibitionId.split(",");
                    var reviewId = ids[0];
                    var exhibitionId = ids[1];

                    console.log(reviewId);
                    console.log(exhibitionId)

                    var data = {

                        id: reviewId

                    };

                    $.ajax({

                        url: `/exhibition/exhibition/${exhibitionId}/comment`,
                        method: 'DELETE',
                        contentType: 'application/json',
                        data: JSON.stringify(data),
                        success: function () {

                            alert("전시 댓글 삭제 성공");
                            $("#review").click()

                        },
                        error: function (error) {

                            alert("전시 댓글 삭제 실패");

                        }
                    })
                })


                //#endregion


                //#region 상단바 : 문화재

                //#endregion


                //#region 하단바 : 축제의 찜키워드 , 관심없음 키워드


                /**
                 * 축제 찜 키워드 중 카운트가 10개 이상인 것을 가져옴
                 *
                 */
                function findFestivalBigLoveKeyword() {

                    $.ajax({

                        url: '/festival/findFestivalBigLoveKeyword',
                        method: 'POST',
                        contentType: 'application/json',
                        success: function (list) {
                            console.log("findFestivalBigLoveKeyword")
                            console.log(list);
                            $('#festivalKeywordList').html("");
                            var concat = '';
                            $.each(list, function (index, keyword) {

                                var htmlContent = `<button value="${keyword.festivalKeywordId}" class="festivalLoveKeywordBtn bigLove">${keyword.festivalKeywordId}</button>`;

                                $('#festivalKeywordList').append(htmlContent);

                                concat += keyword.festivalKeywordId + " ";

                            })

                            $('#festivalKeyword').val(concat.trim() + " ");

                            findFestivalSmallLoveKeyword(1);

                        }

                    })

                }


                /**
                 * 축제 찜 키워드 중 카운트가 10개 미만인 것을 5개씩 가져옴
                 *
                 */
                function findFestivalSmallLoveKeyword(page) {

                    $.ajax({

                        url: '/festival/findFestivalSmallLoveKeyword?page=' + page,
                        method: 'POST',
                        contentType: 'application/json',
                        success: function (list) {
                            console.log("findFestivalSmallLoveKeyword")
                            console.log(list);
                            $.each(list, function (index, keyword) {

                                var htmlContent = `<button value="${keyword.festivalKeywordId}" class="festivalLoveKeywordBtn">${keyword.festivalKeywordId}</button>`;

                                $('#festivalKeywordList').append(htmlContent);

                            })

                        }

                    })

                }


                /**
                 * 축제 찜 키워드 추가 버튼
                 *
                 */
                $(document).on('click', '#addFestivalLoveKeyword', function () {
                    var page = parseInt($(this).val());
                    page = page + 1;
                    findFestivalSmallLoveKeyword(page);
                    $(this).val(page);

                })

                findFestivalBigLoveKeyword();


                /**
                 * 축제 찜 키워드 선택 시 색 변화 버튼
                 *
                 */
                $(document).on('click', '.festivalLoveKeywordBtn', function () {

                    if ($(this).hasClass('bigLove')) {

                        $(this).removeClass('bigLove');

                    } else {

                        $(this).addClass('bigLove');

                    }

                    var btns = document.querySelectorAll('.festivalLoveKeywordBtn.bigLove');

                    var concat = '';

                    btns.forEach(function (btn) {

                        concat += (btn.value + " ");

                    })

                    $('#festivalKeyword').val(concat.trim());


                })


                /**
                 * 축제 관심없음 키워드 중 카운트가 10개 이상인 것을 가져옴
                 *
                 */
                function findFestivalBigHateKeyword() {

                    $.ajax({

                        url: '/festival/findFestivalBigHateKeyword',
                        method: 'POST',
                        contentType: 'application/json',
                        success: function (list) {
                            console.log("findFestivalBigHateKeyword")
                            console.log(list);
                            $('#festivalKeywordList').html("");
                            var concat = '';
                            $.each(list, function (index, keyword) {

                                var htmlContent = `<button value="${keyword.festivalKeywordId}" class="festivalHateKeywordBtn bigHate">${keyword.festivalKeywordId}</button>`;

                                $('#festivalKeywordList').append(htmlContent);

                                concat += keyword.festivalKeywordId + " ";

                            })

                            $('#festivalKeyword').val(concat.trim() + " ");

                            findFestivalSmallHateKeyword(1);

                        }

                    })

                }


                /**
                 * 축제 관심없음 키워드 중 카운트가 10개 미만인 것을 5개씩 가져옴
                 *
                 */
                function findFestivalSmallHateKeyword(page) {

                    $.ajax({

                        url: '/festival/findFestivalSmallHateKeyword?page=' + page,
                        method: 'POST',
                        contentType: 'application/json',
                        success: function (list) {
                            console.log("findFestivalSmallHateKeyword")
                            console.log(list);
                            $.each(list, function (index, keyword) {

                                var htmlContent = `<button value="${keyword.festivalKeywordId}" class="festivalHateKeywordBtn">${keyword.festivalKeywordId}</button>`;

                                $('#festivalKeywordList').append(htmlContent);

                            })

                        }

                    })

                }


                /**
                 * 축제 관심없음 키워드 추가 버튼
                 *
                 */
                $(document).on('click', '#addFestivalHateKeyword', function () {
                    var page = parseInt($(this).val());
                    page = page + 1;
                    findFestivalSmallHateKeyword(page);
                    $(this).val(page);

                })


                /**
                 * 축제 관심없음 키워드 선택 시 색 변화 버튼
                 *
                 */
                $(document).on('click', '.festivalHateKeywordBtn', function () {

                    if ($(this).hasClass('bigHate')) {

                        $(this).removeClass('bigHate');

                    } else {

                        $(this).addClass('bigHate');

                    }

                    var btns = document.querySelectorAll('.festivalHateKeywordBtn.bigHate');

                    var concat = '';

                    btns.forEach(function (btn) {

                        concat += (btn.value + " ");

                    })

                    $('#festivalKeyword').val(concat.trim());


                })


                /**
                 * 찜 키워드 선호키워드 수정버튼 클릭
                 *
                 */
                $(document).on('click', '#keywordCountUpdate', function () {

                    var type = $('#loveOrHate').val();
                    var formData = new FormData($('#insertUserBigLoveHateKeyword')[0]);

                    $.ajax({

                        url: '/user/insertUserBigLoveHateKeyword',
                        method: 'POST',
                        data: formData,
                        processData: false,
                        contentType: false,
                        success: function () {

                            if (type == "L") {
                                alert("선호 키워드 수정 성공!!");
                                $('#loveKeywordList').click();
                            } else {
                                alert("비선호 키워드 수정 성공!!");
                                $('#hateKeywordList').click();
                            }

                        },
                        error: function () {

                            alert("선택 키워드 수정 실패")

                        }
                    })
                })


                //#endregion


                //#region 하단바 : 전시의 찜키워드 , 관심없음 키워드


                /**
                 * 전시 찜 키워드를 가져옴
                 *
                 */
                async function findExhibitionLoveKeyword() {

                    var currentCursor = $("#addExhibitionLoveKeyword").val();
                    // 현재 사용자의 관심도 10 이상인 키워드 가져오기
                    // true 면 내꺼 중 관심도 10이상인거, false 면 모든 데이터
                    let interestedList = (await axios({
                        url: '/exhibition/exhibition/keyword/user',
                        method: 'GET',
                        params: {
                            isUserSelected: true,
                            size: 9999
                        },
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    })).data;
                    // 모든 데이터 가져옴
                    let notInterestedList = (await axios({
                        url: '/exhibition/exhibition/keyword/user',
                        method: 'GET',
                        params: {
                            isUserSelected: false,
                            size: 9999
                        },
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    })).data;
                    // $("#addExhibitionLoveKeyword").val(notInterestedList?.data?.at(-1)?.nextCursor);


                    console.log("findExhibitionBigLoveKeyword()");
                    console.log('InterestedList : ', interestedList);
                    console.log('notInterestedList : ', notInterestedList);

                    // 관심 있는건지 그냥 나온건지 표시
                    notInterestedList = notInterestedList.data.map(v => ({
                        ...v,
                        isInterested: false
                    }))

                    interestedList = interestedList.data.map(v => ({
                        ...v,
                        isInterested: true
                    }))

                    // 중복 데이터 제거 (관심있음 되어있는거)
                    let mergedObject = {};
                    notInterestedList.forEach(item => {
                        mergedObject[item.keyword] = item;
                    });

                    interestedList.forEach(item => {
                        mergedObject[item.keyword] = item;
                    });

                    const dataList = Object.values(mergedObject);


                    $('#exhibitionKeywordList').html("");
                    var concat = '';

                    // 처음에 보여줄 개수 (관심있음 + 관심처리 안된거 5개)
                    const initLen = interestedList.length + 5

                    // 데이터 순서 정렬, true 먼저 나오고 이후 frequency 순서
                    dataList.sort((a, b) => b.isInterested - a.isInterested || b.frequency - a.frequency)

                    console.log('Merged Array : ', dataList);

                    for (let i = 0; i < initLen; i++) {
                        const keyword = dataList[i]
                        var htmlContent = '';
                        if (keyword.isInterested) {
                            htmlContent = `<button value="${keyword.keyword}" class="exhibitionLoveKeywordBtn bigLove">${keyword.keyword}</button>`;
                        } else {
                            htmlContent = `<button value="${keyword.keyword}" class="exhibitionLoveKeywordBtn">${keyword.keyword}</button>`;
                        }

                        $('#exhibitionKeywordList').append(htmlContent);
                        concat += keyword.keyword + " ";
                    }

                    //?
                    $('#exhibitionKeyword').val(concat.trim() + " ");

                }

                findExhibitionLoveKeyword();


                //#endregion




                // 문화재 찜, 관심없음 내역

                // 문화재 찜/관심없음 버튼 클릭 이벤트
                $(document).on('click', '.cheart, .chate', function(e) {
                    e.stopPropagation();
                    var img = $(this);
                    var culturalPropertyId = img.attr('value');
                    var currentInterestType = img.data('type');
                    var newInterestType = img.hasClass('cheart') ? 'LIKE' : 'DISLIKE';

                    // 현재 상태 확인
                    var isCurrentlyInterested = img.attr('src').includes('Blue.png') || img.attr('src').includes('Red.png');

                    if (isCurrentlyInterested && currentInterestType === newInterestType) {
                        // 이미 관심 상태인 경우 제거
                        $.ajax({
                            url: '/cultural-properties/removeUserInterest',
                            method: 'POST',
                            data: {
                                culturalPropertiesId: culturalPropertyId,
                                interestType: currentInterestType
                            },
                            success: function(response) {
                                alert(response);
                                updateInterestUI(img, null);
                                loadCulturalPropertiesInterests(currentInterestType);
                            },
                            error: function(xhr, status, error) {
                                console.error("Error removing interest:", error);
                                alert("관심 제거 실패: " + error);
                            }
                        });
                    } else {
                        // 새로운 관심 추가 또는 변경
                        $.ajax({
                            url: '/cultural-properties/addUserInterest',
                            method: 'POST',
                            data: {
                                culturalPropertiesId: culturalPropertyId,
                                interestType: newInterestType
                            },
                            success: function(response) {
                                alert(response);
                                updateInterestUI(img, newInterestType);
                                loadCulturalPropertiesInterests(newInterestType);
                            },
                            error: function(xhr, status, error) {
                                console.error("Error updating interest:", error);
                                alert("관심 상태 업데이트 실패: " + error);
                            }
                        });
                    }
                });

                // UI 업데이트 함수
                function updateInterestUI(img, newInterestType) {
                    var heartImg = img.closest('.card').find('.cheart');
                    var hateImg = img.closest('.card').find('.chate');

                    if (newInterestType === 'LIKE') {
                        heartImg.attr('src', 'https://kr.object.ncloudstorage.com/team3/common/upBlue.png');
                        hateImg.attr('src', 'https://kr.object.ncloudstorage.com/team3/common/downNo.png');
                    } else if (newInterestType === 'DISLIKE') {
                        heartImg.attr('src', 'https://kr.object.ncloudstorage.com/team3/common/upNo.png');
                        hateImg.attr('src', 'https://kr.object.ncloudstorage.com/team3/common/downRed.png');
                    } else {
                        heartImg.attr('src', 'https://kr.object.ncloudstorage.com/team3/common/upNo.png');
                        hateImg.attr('src', 'https://kr.object.ncloudstorage.com/team3/common/downNo.png');
                    }

                    img.data('type', newInterestType);
                }

                // 문화재 관심 목록 로드 함수
                function loadCulturalPropertiesInterests(interestType) {
                    $.ajax({
                        url: '/cultural-properties/getUserInterest',
                        method: 'GET',
                        data: { interestType: interestType },
                        success: function(response) {
                            console.log("Received data:", response);
                            $('#upper').html("");
                            if (response.length === 0) {
                                $('#upper').html("<p>" + (interestType === 'LIKE' ? '찜한' : '관심없음') + " 문화재가 없습니다.</p>");
                                return;
                            }
                            $.each(response, function(index, property) {
                                var html = `
                                    <div class="card" id="${property.id}">
                                        <img class="card-img-top" src="${property.imgUrl && property.imgUrl.length > 0 ? property.imgUrl[0] : '/img/festival/noPhoto.png'}" alt="Cultural Property Image">
                                        <div class="card-body">
                                            <h5 class="card-title">${property.culturalPropertiesName}</h5>
                                            <p class="card-text">${property.categoryName}</p>
                                            <p class="card-text">${property.region + ' ' + property.district}</p>
                                            <p class="card-text">${property.dynasty}</p>
                                            <div class="buttonZone">
                                                <button class="whiteHeartBtn">
                                                    <img src="${interestType === 'LIKE' ? 'https://kr.object.ncloudstorage.com/team3/common/upBlue.png' : 'https://kr.object.ncloudstorage.com/team3/common/upNo.png'}"
                                                       style="width : 25px; height: 25px;" class="cheart" value="${property.id}" data-type="${interestType}">
                                                </button>
                                                <button class="whiteHateBtn">
                                                    <img src="${interestType === 'LIKE' ? 'https://kr.object.ncloudstorage.com/team3/common/downNo.png' : 'https://kr.object.ncloudstorage.com/team3/common/downRed.png'}"
                                                       style="width : 25px; height: 25px;" class="chate" value="${property.id}" data-type="${interestType}">
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                `;
                                $('#upper').append(html);
                            });
                        },
                        error: function(xhr, status, error) {
                            console.error("Error loading interests:", error);
                            console.log("Status:", status);
                            console.log("Response:", xhr.responseText);
                            $('#upper').html("<p>데이터를 불러오는데 실패했습니다.</p>");
                        }
                    });
                }

                // 문화재 찜 목록 버튼 클릭 이벤트
                $(document).on('click', '#culturalPropertiesLove', function() {
                    $('#leftZone').addClass('none');
                    $('#upperZone').removeClass('none');
                    $('#downZone').addClass('none');

                    $('#userInfo').closest('.genre-item').removeClass('active');
                    $('#culturalPropertiesLove').closest('.genre-item').addClass('active');
                    $('#culturalPropertiesHate').closest('.genre-item').removeClass('active');
                    $('#review').closest('.genre-item').removeClass('active');
                    $('#loveKeywordList').closest('.genre-item').removeClass('active');
                    $('#hateKeywordList').closest('.genre-item').removeClass('active');

                    loadCulturalPropertiesInterests('LIKE');
                });

                // 문화재 관심없음 목록 버튼 클릭 이벤트
                $(document).on('click', '#culturalPropertiesHate', function() {
                    $('#leftZone').addClass('none');
                    $('#upperZone').removeClass('none');
                    $('#downZone').addClass('none');

                    $('#userInfo').closest('.genre-item').removeClass('active');
                    $('#culturalPropertiesLove').closest('.genre-item').removeClass('active');
                    $('#culturalPropertiesHate').closest('.genre-item').addClass('active');
                    $('#review').closest('.genre-item').removeClass('active');
                    $('#loveKeywordList').closest('.genre-item').removeClass('active');
                    $('#hateKeywordList').closest('.genre-item').removeClass('active');

                    loadCulturalPropertiesInterests('DISLIKE');
                });

                // 문화재 카드 클릭 시 상세 페이지로 이동
                $(document).on('click', '.card', function() {
                    var culturalPropertyId = $(this).attr('id');
                    window.location.href = '/cultural-properties/detail/' + culturalPropertyId;
                });








                //문화재 리뷰

<!--                function loadMyReviews(page = 0) {-->
<!--    $.ajax({-->
<!--        url: '/cultural-properties/myReviews',-->
<!--        method: 'GET',-->
<!--        data: { page: page },-->
<!--        success: function(response) {-->
<!--            $('#upper').html("");-->
<!--            var reviewsHtml = '<h2>내가 쓴 리뷰</h2>';-->
<!--            response.reviews.forEach(function(review) {-->
<!--                reviewsHtml += `-->
<!--                    <div class="review-item">-->
<!--                        <h3>${review.culturalPropertiesName}</h3>-->
<!--                        <p>평점: ${review.star}</p>-->
<!--                        <p>${review.content}</p>-->
<!--                        <p>작성일: ${new Date(review.createdAt).toLocaleDateString()}</p>-->
<!--                    </div>-->
<!--                `;-->
<!--            });-->

<!--            // 페이징 버튼 추가-->
<!--            reviewsHtml += '<div class="pagination">';-->
<!--            for (let i = 0; i < response.totalPages; i++) {-->
<!--                reviewsHtml += `<button class="page-btn" data-page="${i}">${i + 1}</button>`;-->
<!--            }-->
<!--            reviewsHtml += '</div>';-->

<!--            $('#upper').html(reviewsHtml);-->

<!--            // 페이지 버튼 클릭 이벤트-->
<!--            $('.page-btn').click(function() {-->
<!--                loadMyReviews($(this).data('page'));-->
<!--            });-->
<!--        },-->
<!--        error: function(xhr, status, error) {-->
<!--            console.error("Error loading reviews:", error);-->
<!--            $('#upper').html("<p>리뷰를 불러오는데 실패했습니다.</p>");-->
<!--        }-->
<!--    });-->
<!--}-->


<!--////////////////////////////////////////////////////////-->

<!--function loadMyReviews(page = 0) {-->
<!--    $.ajax({-->
<!--        url: '/cultural-properties/myReviews',-->
<!--        method: 'GET',-->
<!--        data: { page: page },-->
<!--        success: function(response) {-->
<!--            $('#upper').html("");-->
<!--            const reviewCount = response.totalElements;-->

<!--            var reviewsHtml = `-->
<!--                <div class="reviews">-->
<!--                    <h2 style="display: inline-block;">리뷰</h2>-->
<!--                    <div id="totalReviewCount" class="mt-3" style="display: inline-block; margin-left: 10px;">-->
<!--                        <span>${reviewCount}</span>-->
<!--                    </div>-->
<!--            `;-->

<!--            if (reviewCount === 0) {-->
<!--                reviewsHtml += '<br><br><br><br><br><div class="no-reviews" style="font-size: 20px;">리뷰가 없습니다. 리뷰를 작성해보세요.</div><br><br><br><br><br>';-->
<!--            } else {-->
<!--                response.reviews.forEach(function(review) {-->
<!--                    const createdAt = new Date(review.createdAt);-->
<!--                    const formattedDate = createdAt.toISOString().slice(0, 19).replace('T', ' ') + '             ';-->

<!--                    const updatedAtHtml = review.updatedAt && review.updatedAt !== review.createdAt-->
<!--                        ? ` 수정 : ${new Date(review.updatedAt).toISOString().slice(0, 19).replace('T', ' ')}`-->
<!--                        : '';-->

<!--                    reviewsHtml += `-->
<!--                        <div class="review">-->
<!--                            <div class="user-info">-->
<!--                                <img src="${review.userProfileImage ? 'https://kr.object.ncloudstorage.com/team3' + review.userProfileImage : 'https://kr.object.ncloudstorage.com/team3/img/festival/noPhoto.png'}" alt="${review.userName}">-->
<!--                                <div class="user-details">-->
<!--                                    <span>${review.userName}</span>-->
<!--                                    <span style="font-size: 13px; color: #999;">-->
<!--                                        ${formattedDate}   ${updatedAtHtml}-->
<!--                                    </span>-->
<!--                                    <div class="review-rating" data-rating="${review.star}">-->
<!--                                        ${Array.from({ length: 5 }, (_, index) => {-->
<!--                                            if (index < review.star) {-->
<!--                                                return '<span class="review-star">&#9733;</span>';-->
<!--                                            } else {-->
<!--                                                return '<span class="review-star empty">&#9734;</span>';-->
<!--                                            }-->
<!--                                        }).join('')}-->
<!--                                    </div>-->
<!--                                </div>-->
<!--                            </div>-->
<!--                            <div class="review-content">-->
<!--                                <p class="review-content-p-${review.id}">${review.content}</p>-->
<!--                                <div class="review-text-container">-->
<!--                                    <textarea id="editContent-${review.id}" rows="5" style="display:none;" value="${review.content}">${review.content}</textarea>-->
<!--                                </div>-->
<!--                            </div>-->
<!--                            <div class="review-actions">-->
<!--                                <button type="button" class="btn btn-outline-success detail-btn" onclick="location.href='/cultural-properties/detail/${review.culturalPropertiesId}'">상세</button>-->
<!--                                <button type="button" class="btn btn-outline-success edit-btn" id="edit-btn-${review.id}" data-id="${review.id}">수정</button>-->
<!--                                <button type="button" class="btn btn-outline-success delete-btn" id="delete-btn-${review.id}" data-id="${review.id}" data-cultural-id="${review.culturalPropertiesId}">삭제</button>-->
<!--                                <button type="button" class="btn btn-outline-success save-btn" id="save-btn-${review.id}" style="display:none;" data-id="${review.id}" data-cultural-id="${review.culturalPropertiesId}">저장</button>-->
<!--                                <button type="button" class="btn btn-outline-success cancel-btn" id="cancel-btn-${review.id}" style="display:none;">취소</button>-->
<!--                            </div>-->
<!--                        </div>-->
<!--                    `;-->
<!--                });-->
<!--            }-->

<!--            reviewsHtml += '</div>';-->

<!--            // 페이징 버튼 추가-->
<!--            reviewsHtml += '<div class="pagination">';-->
<!--            for (let i = 0; i < response.totalPages; i++) {-->
<!--                reviewsHtml += `<button class="page-btn" data-page="${i}">${i + 1}</button>`;-->
<!--            }-->
<!--            reviewsHtml += '</div>';-->

<!--            $('#upper').html(reviewsHtml);-->

<!--            // 페이지 버튼 클릭 이벤트-->
<!--            $('.page-btn').click(function() {-->
<!--                loadMyReviews($(this).data('page'));-->
<!--            });-->

<!--            // 수정 버튼 클릭 이벤트-->
<!--            $('.edit-btn').click(function() {-->
<!--                var reviewId = $(this).data('id');-->
<!--                $(this).hide();-->
<!--                $('#delete-btn-' + reviewId).hide();-->
<!--                $('#save-btn-' + reviewId).show();-->
<!--                $('#cancel-btn-' + reviewId).show();-->
<!--                $('.review-content-p-' + reviewId).hide();-->
<!--                $('#editContent-' + reviewId).show();-->
<!--            });-->

<!--            // 취소 버튼 클릭 이벤트-->
<!--            $('.cancel-btn').click(function() {-->
<!--                var reviewId = $(this).attr('id').split('-')[2];-->
<!--                $('#edit-btn-' + reviewId).show();-->
<!--                $('#delete-btn-' + reviewId).show();-->
<!--                $(this).hide();-->
<!--                $('#save-btn-' + reviewId).hide();-->
<!--                $('.review-content-p-' + reviewId).show();-->
<!--                $('#editContent-' + reviewId).hide();-->
<!--            });-->

<!--            // 저장 버튼 클릭 이벤트-->
<!--            $('.save-btn').click(function() {-->
<!--                var reviewId = $(this).data('id');-->
<!--                var culturalPropertiesId = $(this).data('cultural-id');-->
<!--                var content = $('#editContent-' + reviewId).val();-->

<!--                $.ajax({-->
<!--                    url: '/cultural-properties/detail/' + culturalPropertiesId + '/review/update',-->
<!--                    method: 'PUT',-->
<!--                    contentType: 'application/json',-->
<!--                    data: JSON.stringify({-->
<!--                        id: reviewId,-->
<!--                        content: content-->
<!--                    }),-->
<!--                    success: function(response) {-->
<!--                        alert("리뷰가 성공적으로 수정되었습니다.");-->
<!--                        loadMyReviews(page);-->
<!--                    },-->
<!--                    error: function(xhr, status, error) {-->
<!--                        alert("리뷰 수정에 실패했습니다.");-->
<!--                    }-->
<!--                });-->
<!--            });-->

<!--            // 삭제 버튼 클릭 이벤트-->
<!--            $('.delete-btn').click(function() {-->
<!--                var reviewId = $(this).data('id');-->
<!--                var culturalPropertiesId = $(this).data('cultural-id');-->

<!--                if (confirm("정말로 이 리뷰를 삭제하시겠습니까?")) {-->
<!--                    $.ajax({-->
<!--                        url: '/cultural-properties/detail/' + culturalPropertiesId + '/review/remove',-->
<!--                        method: 'DELETE',-->
<!--                        data: { id: reviewId },-->
<!--                        success: function(response) {-->
<!--                            alert("리뷰가 성공적으로 삭제되었습니다.");-->
<!--                            loadMyReviews(page);-->
<!--                        },-->
<!--                        error: function(xhr, status, error) {-->
<!--                            alert("리뷰 삭제에 실패했습니다.");-->
<!--                        }-->
<!--                    });-->
<!--                }-->
<!--            });-->
<!--        },-->
<!--        error: function(xhr, status, error) {-->
<!--            console.error("Error loading reviews:", error);-->
<!--            $('#upper').html("<p>리뷰를 불러오는데 실패했습니다.</p>");-->
<!--        }-->
<!--    });-->
<!--}-->
<!--///////////////////////////////////////////////-->


function loadMyReviews(page = 0) {
    $.ajax({
        url: '/cultural-properties/myReviews',
        method: 'GET',
        data: { page: page },
        success: function(response) {
            $('#upper').html("");
            var reviewCount = response.totalItems; // 총 리뷰 수

            // 리뷰 카운트 업데이트
            var reviewCountHtml = `<span>${reviewCount}</span>`;
            $('#totalReviewCount').html(reviewCountHtml);

            var reviewsHtml = `
                <div class="reviews">
                    <h2 style="display: inline-block;">리뷰</h2>
                    <div id="totalReviewCount" class="mt-3" style="display: inline-block; margin-left: 10px;">
                        <span>${reviewCount}</span>
                    </div>
            `;

            // 리뷰가 없는 경우 메시지 추가
            if (reviewCount === 0) {
                reviewsHtml += '<br><br><br><br><br><div class="no-reviews" style="font-size: 20px;">리뷰가 없습니다. 리뷰를 작성해보세요.</div><br><br><br><br><br>';
            } else {
                response.reviews.forEach(function(review) {
                    // createdAt 값을 Date 객체로 변환
                    const createdAt = new Date(review.createdAt);
                    // (YYYY-MM-DD HH:mm:ss) 형식으로 날짜 포맷팅
                    const formattedDate = createdAt.toISOString().slice(0, 19).replace('T', ' ') + '             ';

                    // updatedAt 포맷팅 (updatedAt이 존재하는 경우)
                    const updatedAtHtml = review.updatedAt && review.updatedAt !== review.createdAt
                        ? ` 수정 : ${new Date(review.updatedAt).toISOString().slice(0, 19).replace('T', ' ')}`
                        : '';

                    reviewsHtml += `
                        <div class="review">
                            <div class="user-info">
                                <img src="${review.userProfileImage ? 'https://kr.object.ncloudstorage.com/team3' + review.userProfileImage : 'https://kr.object.ncloudstorage.com/team3/img/festival/noPhoto.png'}" alt="${review.userName}">
                                <div class="user-details">
                                    <span>${review.userName}</span>
                                    <span style="font-size: 13px; color: #999;">
                                        ${formattedDate}   ${updatedAtHtml}
                                    </span>
                                    <div class="review-rating" data-rating="${review.star}">
                                        ${Array.from({ length: 5 }, (_, index) => {
                                            if (index < review.star) {
                                                return '<span class="review-star">&#9733;</span>';
                                            } else {
                                                return '<span class="review-star empty">&#9734;</span>';
                                            }
                                        }).join('')}
                                    </div>
                                </div>
                            </div>
                            <div class="review-content">
                                <p class="review-content-p-${review.id}">${review.content}</p>
                                <div class="review-text-container">
                                    <textarea id="editContent-${review.id}" rows="5" style="display:none;" value="${review.content}">${review.content}</textarea>
                                </div>
                            </div>
                            <div class="review-actions">
                                <button type="button" class="btn btn-outline-success detail-btn" onclick="location.href='/cultural-properties/detail/${review.culturalPropertiesId}'">상세</button>
                                <button type="button" class="btn btn-outline-success edit-btn" id="edit-btn-${review.id}" data-id="${review.id}">수정</button>
                                <button type="button" class="btn btn-outline-success delete-btn" id="delete-btn-${review.id}" data-id="${review.id}" data-cultural-id="${review.culturalPropertiesId}">삭제</button>
                                <button type="button" class="btn btn-outline-success save-btn" id="save-btn-${review.id}" style="display:none;" data-id="${review.id}" data-cultural-id="${review.culturalPropertiesId}">저장</button>
                                <button type="button" class="btn btn-outline-success cancel-btn" id="cancel-btn-${review.id}" style="display:none;">취소</button>
                            </div>
                        </div>
                    `;
                });
            }

            reviewsHtml += '</div>';

            // 페이징 버튼 추가
            reviewsHtml += '<div class="pagination">';
            for (let i = 0; i < response.totalPages; i++) {
                reviewsHtml += `<button class="page-btn" data-page="${i}">${i + 1}</button>`;
            }
            reviewsHtml += '</div>';

            $('#upper').html(reviewsHtml);

            // 페이지 버튼 클릭 이벤트
            $('.page-btn').click(function() {
                loadMyReviews($(this).data('page'));
            });

            // 수정 버튼 클릭 이벤트
            $('.edit-btn').click(function() {
                var reviewId = $(this).data('id');
                $(this).hide();
                $('#delete-btn-' + reviewId).hide();
                $('#save-btn-' + reviewId).show();
                $('#cancel-btn-' + reviewId).show();
                $('.review-content-p-' + reviewId).hide();
                $('#editContent-' + reviewId).show();
            });

            // 취소 버튼 클릭 이벤트
            $('.cancel-btn').click(function() {
                var reviewId = $(this).attr('id').split('-')[2];
                $('#edit-btn-' + reviewId).show();
                $('#delete-btn-' + reviewId).show();
                $(this).hide();
                $('#save-btn-' + reviewId).hide();
                $('.review-content-p-' + reviewId).show();
                $('#editContent-' + reviewId).hide();
            });

            // 저장 버튼 클릭 이벤트 (여기에 저장 로직 추가 필요)
            $('.save-btn').click(function() {
                // 저장 로직 구현
            });

            // 삭제 버튼 클릭 이벤트
            $('.delete-btn').click(function() {
                var reviewId = $(this).data('id');
                var culturalPropertiesId = $(this).data('cultural-id');

                if (confirm("정말로 이 리뷰를 삭제하시겠습니까?")) {
                    $.ajax({
                        url: '/cultural-properties/detail/' + culturalPropertiesId + '/review/remove',
                        method: 'DELETE',
                        data: { id: reviewId },
                        success: function(response) {
                            alert("리뷰가 성공적으로 삭제되었습니다.");
                            loadMyReviews(page);
                        },
                        error: function(xhr, status, error) {
                            alert("리뷰 삭제에 실패했습니다.");
                        }
                    });
                }
            });
        },
        error: function(xhr, status, error) {
            console.error("Error loading reviews:", error);
            $('#upper').html("<p>리뷰를 불러오는데 실패했습니다.</p>");
        }
    });
}




                //#region
                // 문화재 찜키워드, 관심없음 키워드

                let currentPage = 1;

                function loadInitialCulturalPropertiesKeywords() {
                    const url = $('#loveOrHate').val() === "L" ? '/cultural-properties/like/keywords' : '/cultural-properties/dislike/keywords';
                    $.ajax({
                        url: url,
                        method: 'GET',
                        success: function(response) {
                            // 초기 키워드를 모두 초록색으로 표시
                            const initialKeywords = response.map(keyword => ({
                                ...keyword,
                                isInitial: true  // 초기 키워드임을 표시
                            }));
                            displayCulturalPropertiesKeywords(initialKeywords);
                            loadUnselectedCulturalPropertiesKeywords();
                        },
                        error: function(xhr, status, error) {
                            console.error("Error loading initial keywords:", error);
                        }
                    });
                }

                function loadUnselectedCulturalPropertiesKeywords() {
                    $.ajax({
                        url: '/cultural-properties/keywords',
                        method: 'GET',
                        data: { page: currentPage, limit: 5 },
                        success: function(response) {
                            displayCulturalPropertiesKeywords(response, true);
                        },
                        error: function(xhr, status, error) {
                            console.error("Error loading unselected keywords:", error);
                        }
                    });
                }


                function displayCulturalPropertiesKeywords(keywords, append = false) {
                    const keywordList = $('#culturalPropertiesKeywordList');
                    if (!append) {
                        keywordList.empty();
                    }
                    keywords.forEach(keyword => {
                        const keywordButton = $('<button>')
                            .addClass('culturalPropertiesKeywordBtn')
                            .text(keyword.keyword)
                            .attr('data-id', keyword.keywordId)
                            .attr('data-count', keyword.totalCount);

                        if (keyword.isInitial) {
                            // 초기 키워드는 loveOrHate 값에 따라 클래스 추가
                            keywordButton.addClass($('#loveOrHate').val() === "L" ? 'bigLove' : 'bigHate');
                        } else if ($('#loveOrHate').val() === "L" && keyword.totalCount >= 10) {
                            keywordButton.addClass('bigLove');
                        } else if ($('#loveOrHate').val() === "H" && keyword.totalCount <= -10) {
                            keywordButton.addClass('bigHate');
                        }

                        keywordList.append(keywordButton);
                    });
                }


                $(document).on('click', '.culturalPropertiesKeywordBtn', function() {
                    const isLove = $('#loveOrHate').val() === "L";
                    $(this).toggleClass(isLove ? 'bigLove' : 'bigHate');
                    updateSelectedCulturalPropertiesKeywords();
                });

                function updateSelectedCulturalPropertiesKeywords() {
                    const isLove = $('#loveOrHate').val() === "L";
                    const selectedKeywords = $(`.culturalPropertiesKeywordBtn.${isLove ? 'bigLove' : 'bigHate'}`)
                        .map(function() { return $(this).text(); }).get().join(',');
                    $('#culturalPropertiesKeyword').val(selectedKeywords);
                }


                $('#loveKeywordList, #hateKeywordList').on('click', function() {
                    const isLove = $(this).attr('id') === 'loveKeywordList';
                    $('#loveOrHate').val(isLove ? "L" : "H");
                    $('#keywordCountUpdate').text(isLove ? "선호 키워드 수정" : "비선호 키워드 수정");
                    $('#addCulturalPropertiesLoveKeyword').toggle(isLove);
                    $('#addCulturalPropertiesHateKeyword').toggle(!isLove);
                    currentPage = 1;
                    loadInitialCulturalPropertiesKeywords();
                });

                $(document).ready(function() {
                    $('#loveKeywordList').click(); // 초기 로드 시 찜 키워드 목록 표시
                });

                $(document).on('click', '#addCulturalPropertiesLoveKeyword, #addCulturalPropertiesHateKeyword', function() {
                    console.log("버튼 클릭됨");
                    currentPage++;
                    loadUnselectedCulturalPropertiesKeywords();
                });






                //#endregion


                // #region 상단 필터 바 클릭 이벤트


                /**
                 * 카테고리 드롭다운 클릭 시 텍스트를 가져옴
                 *
                 */
                $(document).on('click', '.category', function () {

                    var categoryText = $(this).text();
                    $('#category').text(categoryText);

                    $('#leftZone').addClass('none');
                    $('#upperZone').removeClass('none');
                    $('#downZone').addClass('none');

                    $('#userInfo').closest('.genre-item').removeClass('active');
                    $('#love').closest('.genre-item').addClass('active');
                    $('#hate').closest('.genre-item').removeClass('active');
                    $('#review').closest('.genre-item').removeClass('active');
                    $('#loveKeywordList').closest('.genre-item').removeClass('active');
                    $('#hateKeywordList').closest('.genre-item').removeClass('active');

                    if (categoryText == "축제") {

                        findLoveFestivalList();

                    } else if (categoryText == "전시") {

                        findLoveExhibitionList();

                    }else if (categoryText == "문화재") {

                        loadCulturalPropertiesInterests('LIKE');

                    }


                })


                /**
                 * 회원정보 클릭 시
                 *
                 */
                $(document).on('click', '#userInfo', function () {


                    $('#leftZone').removeClass('none');
                    $('#upperZone').addClass('none');
                    $('#downZone').addClass('none');

                    $('#userInfo').closest('.genre-item').addClass('active');
                    $('#love').closest('.genre-item').removeClass('active');
                    $('#hate').closest('.genre-item').removeClass('active');
                    $('#review').closest('.genre-item').removeClass('active');
                    $('#loveKeywordList').closest('.genre-item').removeClass('active');
                    $('#hateKeywordList').closest('.genre-item').removeClass('active');

                })

                $('#userInfo').closest('.genre-item').addClass('active');


                /**
                 * 찜한내역 클릭 시 카테고리에 따라 다른 내용이 채워짐
                 *
                 */
                $(document).on('click', '#love', function () {

                    var category = $('#category').text();
                    $('#leftZone').addClass('none');
                    $('#upperZone').removeClass('none');
                    $('#downZone').addClass('none');

                    $('#userInfo').closest('.genre-item').removeClass('active');
                    $('#love').closest('.genre-item').addClass('active');
                    $('#hate').closest('.genre-item').removeClass('active');
                    $('#review').closest('.genre-item').removeClass('active');
                    $('#loveKeywordList').closest('.genre-item').removeClass('active');
                    $('#hateKeywordList').closest('.genre-item').removeClass('active');

                    if (category == "축제") {

                        findLoveFestivalList();

                    } else if (category == "전시") {

                        findLoveExhibitionList();

                    }else if (category == "문화재") {

                        loadCulturalPropertiesInterests('LIKE');

                    }

                })


                /**
                 * 관심없음 내역 클릭 시 카테고리에 따라 다른 내용이 채워짐
                 *
                 */
                $(document).on('click', '#hate', function () {

                    var category = $('#category').text();
                    $('#leftZone').addClass('none');
                    $('#upperZone').removeClass('none');
                    $('#downZone').addClass('none');

                    $('#userInfo').closest('.genre-item').removeClass('active');
                    $('#love').closest('.genre-item').removeClass('active');
                    $('#hate').closest('.genre-item').addClass('active');
                    $('#review').closest('.genre-item').removeClass('active');
                    $('#loveKeywordList').closest('.genre-item').removeClass('active');
                    $('#hateKeywordList').closest('.genre-item').removeClass('active');

                    if (category == "축제") {

                        findHateFestivalList();

                    } else if (category == "전시") {

                        findHateExhibitionList();

                    } else if (category == "문화재") {
                        loadCulturalPropertiesInterests('DISLIKE');
                    }

                })


                /**
                 * 내가 쓴 리뷰 클릭 시 카테고리에 따라 다른 내용이 채워짐
                 *
                 */
                $(document).on('click', '#review', function () {

                    var category = $('#category').text();
                    $('#leftZone').addClass('none');
                    $('#upperZone').removeClass('none');
                    $('#downZone').addClass('none');

                    $('#userInfo').closest('.genre-item').removeClass('active');
                    $('#love').closest('.genre-item').removeClass('active');
                    $('#hate').closest('.genre-item').removeClass('active');
                    $('#review').closest('.genre-item').addClass('active');
                    $('#loveKeywordList').closest('.genre-item').removeClass('active');
                    $('#hateKeywordList').closest('.genre-item').removeClass('active');

                    if (category == "축제") {

                        findFestivalReviewListByPage(1);

                    } else if (category == "전시") {

                        findExhibitionReviewListByPage(1);

                    } else if (category == "문화재") {
                        loadMyReviews();
                    }

                });


                /**
                 * 찜 키워드 클릭 시
                 *
                 */
                $(document).on('click', '#loveKeywordList', function () {


                    $('#leftZone').addClass('none');
                    $('#upperZone').addClass('none');
                    $('#downZone').removeClass('none');

                    $('#userInfo').closest('.genre-item').removeClass('active');
                    $('#love').closest('.genre-item').removeClass('active');
                    $('#hate').closest('.genre-item').removeClass('active');
                    $('#review').closest('.genre-item').removeClass('active');
                    $('#loveKeywordList').closest('.genre-item').addClass('active');
                    $('#hateKeywordList').closest('.genre-item').removeClass('active');


                    var performanceHtml = `

                        <div id="performanceKeywordList"></div>
                        <button id="addPerformanceLoveKeyword" value="1" class="btn btn-outline-success">공연 키워드 추가</button>

                    `;


                    var exhibitionHtml = `

                        <div id="exhibitionKeywordList"></div>
                        <button id="addExhibitionLoveKeyword" value="1"class="btn btn-outline-success">전시 키워드 추가</button>

                    `;


                    var festivalHtml = `

                        <div id="festivalKeywordList"></div>
                        <button id="addFestivalLoveKeyword" value="1" class="btn btn-outline-success">축제 키워드 추가</button>

                    `;


                    var culturalPropertiesHtml = `

                        <div id="culturalPropertiesKeywordList"></div>
                        <button id="addCulturalPropertiesLoveKeyword" value="1" class="btn btn-outline-success">문화재 키워드 추가</button>

                    `;

                    $('#performanceZone').html(performanceHtml);
                    $('#exhibitionZone').html(exhibitionHtml);
                    $('#festivalZone').html(festivalHtml);
                    $('#culturalPropertiesZone').html(culturalPropertiesHtml);

                    $('#festivalKeyword').val("");
                    $('#loveOrHate').val("L");
                    $('#keywordCountUpdate').text("선호 키워드 수정");


                    findFestivalBigLoveKeyword();


                });


                /**
                 * 하단바 관심없음 키워드 클릭 시
                 *
                 */
                $(document).on('click', '#hateKeywordList', function () {

                    $('#leftZone').addClass('none');
                    $('#upperZone').addClass('none');
                    $('#downZone').removeClass('none');

                    $('#userInfo').closest('.genre-item').removeClass('active');
                    $('#love').closest('.genre-item').removeClass('active');
                    $('#hate').closest('.genre-item').removeClass('active');
                    $('#review').closest('.genre-item').removeClass('active');
                    $('#loveKeywordList').closest('.genre-item').removeClass('active');
                    $('#hateKeywordList').closest('.genre-item').addClass('active');


                    var performanceHtml = `

                        <div id="performanceKeywordList"></div>
                        <button id="addPerformanceHateKeyword" value="1" class="btn btn-outline-success">공연 키워드 추가</button>

                    `;


                    var exhibitionHtml = `

                        <div id="exhibitionKeywordList"></div>
                        <button id="addExhibitionHateKeyword" value="1" class="btn btn-outline-success">전시 키워드 추가</button>

                    `;


                    var festivalHtml = `

                        <div id="festivalKeywordList"></div>
                        <button id="addFestivalHateKeyword" value="1" class="btn btn-outline-success">축제 키워드 추가</button>

                    `;


                    var culturalPropertiesHtml = `

                        <div id="culturalPropertiesKeywordList"></div>
                        <button id="addCulturalPropertiesHateKeyword" value="1" class="btn btn-outline-success">문화재 키워드 추가</button>

                    `;

                    $('#performanceZone').html(performanceHtml);
                    $('#exhibitionZone').html(exhibitionHtml);
                    $('#festivalZone').html(festivalHtml);
                    $('#culturalPropertiesZone').html(culturalPropertiesHtml);

                    findFestivalBigHateKeyword();
                    $('#festivalKeyword').val("");
                    $('#loveOrHate').val("H");
                    $('#keywordCountUpdate').text("비선호 키워드 수정");


                });


                //# endregion


            }
        )


    </script>
</head>
<body>

<div layout:fragment="content">

    <div id="realContent">

        <div class="filter-container"> <!-- 필터 컨테이너 추가 -->
            <div class="genre-filter">
                <ul>

                    <li>
                        <div class="genre-item">
                            <a class="userInfo" id="userInfo">회원정보</a>
                        </div>
                    <li>

                    <li class="dropdown">

                        <div class="genre-item">
                            <a class="dropbtn" href="javascript:void(0)" id="category">축제</a>
                            <div class="dropdown-content">
                                <a class="category" id="performance">공연</a>
                                <a class="category" id="exhibition">전시</a>
                                <a class="category" id="festival">축제</a>
                                <a class="category" id="culturalPro">문화재</a>
                            </div>
                        </div>

                    </li>

                    <li>
                        <div class="genre-item">
                            <a id="love">찜한 내역</a>
                        </div>
                    </li>

                    <li>
                        <div class="genre-item">
                            <a id="hate">관심없음 내역</a>
                        </div>
                    </li>

                    <li>
                        <div class="genre-item">
                            <a id="review">내가 쓴 리뷰</a>
                        </div>
                    </li>


                    <li>
                        <div class="genre-item">
                            <a id="loveKeywordList">찜 키워드</a>
                        </div>
                    </li>

                    <li>
                        <div class="genre-item">
                            <a id="hateKeywordList">관심없음 키워드</a>
                        </div>
                    </li>

                </ul>
            </div>
        </div>


        <div id="rightZone">

            <div id="leftZone">

                <form encType="multipart/form-data" id="basicForm" style="font-size: 20px;">
                    <h1 style="color: #7a7272;">회원정보</h1><br><br>

                    <div>
                        <div id="profileImg">
                        </div>

                        <div style="color: #615757;">
                            <label for="uploadFile">사진</label>
                            <input name="uploadFile" class="rounded" id="uploadFile" type="file" accept="image/*"><br>

                            <label for="email">이메일</label>
                            <input name="email" class="rounded" id="email" th:value="${user.email}"
                                   placeholder="${user.email}" required style="background-color: lightblue"
                                   pattern="^[a-zA-Z0-9_]{5,}@[a-zA-Z]{3,}\.com$">
                            <button id="emailValidate" type="button" class="btn btn-outline-success">중복확인</button><br>

                            <label for="password">비밀번호</label>
                            <input name="password" class="rounded" id="password" type="password" required
                                   style="background-color: lightblue" pattern="^[a-zA-Z0-9_]{5,}$"><br>

                            <label for="userName">회원이름</label>
                            <input name="userName" class="rounded" id="userName" th:value="${user.userName}"
                                   placeholder="${user.userName}" pattern="^[a-zA-Z가-힣]{3,}$"
                                   style="background-color: lightblue"><br>

                            <label for="tel">전화번호</label>
                            <input name="tel" class="rounded" id="tel" type="tel" th:value="${user.tel}"
                                   placeholder="${user.tel}" pattern="[0-9]{3}-[0-9]{4}-[0-9]{4}"><br>

                            <label for="userAge">나이</label>
                            <input name="userAge" class="rounded" id="userAge" type="number" th:value="${user.userAge}"
                                   th:placeholder="${user.userAge}"><br>

                            <label for="gender">성별</label>
                            <select name="gender" class="rounded" id="gender" th:value="${user.gender}">
                            </select><br>

                            <label for="regionId">지역</label>
                            <select name="regionId" id="regionId" class="rounded"></select><br>


                            <div style="display: flex;align-items: center;justify-content: space-around; margin-top: 50px;">

                                <button type="submit" id="updateAccount" class="btn btn-outline-success"
                                        th:value="${user.userId}" style="width: 45%;color: white;background-color: green;">수정
                                </button>
                                <button type="button" id="deleteAccount" class="btn btn-outline-success"
                                        th:value="${user.userId}" style="width: 45%;color: white;background-color: green;">탈퇴
                                </button>

                            </div>

                        </div>
                    </div>
                </form>


            </div>

        <div id="upperZone" class="none">


            <div id="upper">

                아아

            </div>


<!--             <div class="none" id="downZone">

                <div id="down">
                    <div id="performanceZone">
                        <div id="performanceKeywordList">
                        </div>
                        <button class="btn btn-outline-success" id="addPerformanceLoveKeyword" value="1">공연 키워드 추가
                        </button>
                    </div>
                    <div id="exhibitionZone">
                        <div id="exhibitionKeywordList">
                        </div>
                        <button class="btn btn-outline-success" id="addExhibitionLoveKeyword" value="">전시 키워드 추가
                        </button>
                    </div>
                    <div id="festivalZone">
                        <div id="festivalKeywordList">
                        </div>
                        <button class="btn btn-outline-success" id="addFestivalLoveKeyword" value="1">축제 키워드 추가</button>
                    </div>
                    <div id="culturalPropertiesZone">
                        <div id="culturalPropertiesKeywordList">
                        </div>
                        <button class="btn btn-outline-success" id="addCulturalPropertiesLoveKeyword" value="1">문화재 키워드
                            추가
                        </button>
                    </div>
                    <div id="updateBtnZone">
                        <form id="insertUserBigLoveHateKeyword" style="font-size: 28px;">
                            <input id="performanceKeyword" name="performanceKeyword" type="hidden">
                            <input id="exhibitionKeyword" name="exhibitionKeyword" type="hidden">
                            <input id="festivalKeyword" name="festivalKeyword" type="hidden">
                            <input id="culturalPropertiesKeyword" name="culturalPropertiesKeyword" type="hidden">
                            <input id="loveOrHate" name="loveOrHate" type="hidden" value="L">
                            <button class="btn btn-outline-success" id="keywordCountUpdate" type="button">선호 키워드 수정
                            </button>
                        </form> -->

        </div>

        <div id="downZone" class="none">

            <div id="down">
                <div id="performanceZone">
                    <div id="performanceKeywordList">
                    </div>
                    <button id="addPerformanceLoveKeyword" value="1" class="btn btn-outline-success">공연 키워드 추가</button>
                </div>
                <div id="exhibitionZone">
                    <div id="exhibitionKeywordList">
                    </div>
                    <button id="addExhibitionLoveKeyword" value="" class="btn btn-outline-success">전시 키워드 추가</button>
                </div>
                <div id="festivalZone">
                    <div id="festivalKeywordList">
                    </div>
                    <button id="addFestivalLoveKeyword" value="1" class="btn btn-outline-success">축제 키워드 추가</button>
                </div>
                <div id="culturalPropertiesZone">
                    <div id="culturalPropertiesKeywordList">
                    </div>
                    <button id="addCulturalPropertiesLoveKeyword" value="1" class="btn btn-outline-success">문화재 키워드 추가
                    </button>
                </div>
                <div id="updateBtnZone">
                    <form style="font-size: 28px;" id="insertUserBigLoveHateKeyword">
                        <input type="hidden" id="performanceKeyword" name="performanceKeyword">
                        <input type="hidden" id="exhibitionKeyword" name="exhibitionKeyword">
                        <input type="hidden" id="festivalKeyword" name="festivalKeyword">
                        <input type="hidden" id="culturalPropertiesKeyword" name="culturalPropertiesKeyword">
                        <input type="hidden" id="loveOrHate" name="loveOrHate" value="L">
                        <button type="button" id="keywordCountUpdate" class="btn btn-outline-success">선호 키워드 수정</button>
                    </form>
                </div>
            </div>

        </div>


    </div>


</div>


</div>


</body>
</html>