<!DOCTYPE html>
<html
  xmlns:th="http://www.thymeleaf.org"
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5"
>
  <html layout:decorate="~{common/layout/layoutMenubar}">
    <html lang="ko">
      <head>
        <style>
          body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
          }
          .tab-menu {
            margin-bottom: 20px;
          }
          .tab-menu button {
            padding: 10px 20px;
            margin-right: 5px;
          }
          .search-bar {
            background-color: #f0f0f0;
            padding: 20px;
            margin-bottom: 20px;
          }
          .search-bar select,
          .search-bar input {
            margin-right: 10px;
            padding: 5px;
          }
          .search-bar button {
            padding: 5px 10px;
          }
          .exhibition-list {
            list-style-type: none;
            padding: 0;
          }
          .exhibition-item {
            display: flex;
            margin-bottom: 20px;
            border: 1px solid #ddd;
            padding: 10px;
          }
          .exhibition-image {
            width: 100px;
            height: 150px;
            object-fit: cover;
            margin-right: 20px;
          }
          .exhibition-info {
            flex-grow: 1;
          }
          .exhibition-actions {
            display: flex;
            align-items: start;
          }
          .action-button {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 20px;
            margin-left: 10px;
          }
        </style>
        <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
        <!-- 기존 head 내용 유지 -->
        <script>
          // 전시회 데이터를 저장할 배열
          /*  let exhibitions = [
            {
              image: "path_to_rembrandt_image.jpg",
              title: "렘브란트, 17세기의 사진가",
              location: "국립중앙박물관",
              date: "2023-07-05~2023-09-29",
            },
            {
              image: "path_to_yusungnam_image.jpg",
              title: "제23회 이인성미술상 수상자전 《윤성남》",
              location: "국립현대미술관",
              date: "2023-07-05~2024-10-21",
            },
            // 추가 전시회 데이터...
          ];  */

          let exhibitions = [];
          let viewStatus = "all"; // pre, current, future, unknown 어떤 버튼 눌렀는지

          function changeViewStatus() {
            viewStatus = $("#view-status").val();
          }

          async function getExhibitions() {
            const response = await axios.get(
              "/admin/exhibition-regulate/db-exhibition"
            );

            console.log("response : ", response);
            exhibitions = response.data.map((item) => {
              return {
                image: item.image,
                title: item.title,
                artist: item.artist,
                museum: item.museum,
                startDate: item.startDate?.substring(0, 10),
                endDate: item.endDate?.substring(0, 10),
              };
            });

            exhibitions = exhibitions.filter((item) => {
              if (viewStatus === "all") {
                return true;
              }

              if (viewStatus === "pre") {
                today = new Date();

                if (
                  item.startDate <= today.getTime() &&
                  item.endDate >= today.getTime()
                ) {
                  return true;
                }
              }
              return false;
            });

            renderExhibitions();
          }

          // 전시회 목록을 렌더링하는 함수
          function renderExhibitions() {
            const $exhibitionList = $(".exhibition-list");
            $exhibitionList.empty(); // 기존 목록 초기화

            $.each(exhibitions, function (index, exhibition) {
              const $li = $("<li>").addClass("exhibition-item");
              $li.html(`
                        <img src="${exhibition.image}" alt="${exhibition.title}" class="exhibition-image">
                        <div class="exhibition-info">
                            <h3>${exhibition.title}</h3>
                            <p>${exhibition.artist}</p>
                            <p>${exhibition.museum}</p>
                            <p>시작일: ${exhibition.startDate}</p>
                            <p>종료일: ${exhibition.endDate}</p>
                        </div>
                        <div class="exhibition-actions">
                            <button class="action-button">♡</button>
                            <button class="action-button">□</button>
                        </div>
                    `);
              $exhibitionList.append($li);
            });
          }

          //페이지에 들어갔을 때 실행 되는 init 함수
          // $(document).ready(init);
          $(document).ready(function () {
            init();

            // 버튼 클릭 이벤트 처리
            $("#currentBtn").click(function () {
              changeViewStatus("current");
            });
            $("#pastBtn").click(function () {
              changeViewStatus("past");
            });
            $("#futureBtn").click(function () {
              changeViewStatus("future");
            });
            $("#unknownBtn").click(function () {
              changeViewStatus("unknown");
            });
          });

          function changeViewStatus(status) {
            viewStatus = status;
            filterAndRenderExhibitions();
          }

          async function getExhibitions() {
            const response = await axios.get(
              "/admin/exhibition-regulate/db-exhibition"
            );

            exhibitions = response.data.map((item) => ({
              image: item.image,
              title: item.title,
              artist: item.artist,
              museum: item.museum,
              startDate: item.startDate ? new Date(item.startDate) : null,
              endDate: item.endDate ? new Date(item.endDate) : null,
            }));

            filterAndRenderExhibitions();
          }

          function filterAndRenderExhibitions() {
            const today = new Date();
            const filteredExhibitions = exhibitions.filter((item) => {
              if (viewStatus === "all") return true;
              if (!item.startDate || !item.endDate)
                return viewStatus === "unknown";

              switch (viewStatus) {
                case "current":
                  return item.startDate <= today && today <= item.endDate;
                case "past":
                  return item.endDate < today;
                case "future":
                  return today < item.startDate;
                default:
                  return false;
              }
            });

            renderExhibitions(filteredExhibitions);
          }

          function renderExhibitions(exhibitionsToRender) {
            const $exhibitionList = $(".exhibition-list");
            $exhibitionList.empty();

            $.each(exhibitionsToRender, function (index, exhibition) {
              const $li = $("<li>").addClass("exhibition-item");
              $li.html(`
                    <img src="${
                      exhibition.image
                    }" alt="${exhibition.title}" class="exhibition-image">
                    <div class="exhibition-info">
                        <h3>${exhibition.title}</h3>
                        <p>${exhibition.artist}</p>
                        <p>${exhibition.museum}</p>
                        <p>시작일: ${
                          exhibition.startDate
                            ? exhibition.startDate.toISOString().split("T")[0]
                            : "미정"
                        }</p>
                        <p>종료일: ${
                          exhibition.endDate
                            ? exhibition.endDate.toISOString().split("T")[0]
                            : "미정"
                        }</p>
                    </div>
                    <div class="exhibition-actions">
                        <button class="action-button">♡</button>
                        <button class="action-button">□</button>
                    </div>
                `);
              $exhibitionList.append($li);
            });
          }
          //

          function init() {
            getExhibitions();
          }

          // 전시회 추가 함수
          function addExhibition(exhibition) {
            exhibitions.push(exhibition);
            renderExhibitions();
          }

          // 전시회 삭제 함수
          function removeExhibition(index) {
            exhibitions.splice(index, 1);
            renderExhibitions();
          }
        </script>
      </head>
      <body>
        <div layout:fragment="content">
          <div class="tab-menu">
            <button id="currentBtn">현재 전시</button>
            <button id="pastBtn">지난 전시</button>
            <button id="futureBtn">예정 전시</button>
            <button id="unknownBtn">미정</button>
          </div>

          <div class="search-bar">
            <input type="text" id="searchTitle" placeholder="전시 이름" />
            <input type="text" id="searchArtist" placeholder="작가" />
            <input type="text" id="searchMuseum" placeholder="미술관" />
            <button id="searchButton">검색</button>
          </div>

          <ul class="exhibition-list">
            <li class="exhibition-item">
              <img
                src="path_to_rembrandt_image.jpg"
                alt="렘브란트, 17세기의 사진가"
                class="exhibition-image"
              />
              <div class="exhibition-info">
                <h3>렘브란트, 17세기의 사진가</h3>
                <p>국립중앙박물관</p>
                <p>2023-07-05~2023-09-29</p>
              </div>
              <div class="exhibition-actions">
                <button class="action-button">♡</button>
                <button class="action-button">□</button>
              </div>
            </li>
            <li class="exhibition-item">
              <img
                src="path_to_yusungnam_image.jpg"
                alt="제23회 이인성미술상 수상자전 《윤성남》"
                class="exhibition-image"
              />
              <div class="exhibition-info">
                <h3>제23회 이인성미술상 수상자전 《윤성남》</h3>
                <p>국립현대미술관</p>
                <p>2023-07-05~2024-10-21</p>
              </div>
              <div class="exhibition-actions">
                <button class="action-button">♡</button>
                <button class="action-button">□</button>
              </div>
            </li>
            <li class="exhibition-item">
              <img
                src="path_to_sojeonggi_image.jpg"
                alt="2024 소장품기획전 《회화적 지도 읽기》"
                class="exhibition-image"
              />
              <div class="exhibition-info">
                <h3>2024 소장품기획전 《회화적 지도 읽기》</h3>
                <p>대전시립미술관</p>
                <p>2024-04-09 ~ 2024-08-18</p>
              </div>
              <div class="exhibition-actions">
                <button class="action-button">♡</button>
                <button class="action-button">□</button>
              </div>
            </li>
            <li class="exhibition-item">
              <img
                src="path_to_digest_image.jpg"
                alt="2024 다이제스트 《이기창: 작업에서 연습으로》"
                class="exhibition-image"
              />
              <div class="exhibition-info">
                <h3>2024 다이제스트 《이기창: 작업에서 연습으로》</h3>
                <p>서귀포시</p>
                <p>2024-04-09 ~ 2024-08-18</p>
              </div>
              <div class="exhibition-actions">
                <button class="action-button">♡</button>
                <button class="action-button">□</button>
              </div>
            </li>
          </ul>
        </div>
      </body>
    </html>
  </html>
</html>
