<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.multi.culture_link.admin.culturalProperties.model.dao.AdminCulturalPropertiesDAO">

    <resultMap id="culturalPropertiesResultMap"
               type="com.multi.culture_link.admin.culturalProperties.model.dto.CulturalPropertiesDTO">
        <!-- List<String> imgUrl 매핑 -->
        <result property="imgUrl" column="img_url" jdbcType="VARCHAR" javaType="java.util.List"
                typeHandler="com.multi.culture_link.admin.culturalProperties.model.dto.StringListTypeHandler"/>
        <!-- imgDesc 매핑 -->
        <result property="imgDesc" column="img_desc" jdbcType="VARCHAR"/>
        <!-- videoUrl 매핑 -->
        <result property="videoUrl" column="video_url" jdbcType="VARCHAR"/>
        <!-- narrationUrl 매핑 -->
        <result property="narrationUrl" column="narration_url" jdbcType="VARCHAR"/>
    </resultMap>

    <insert id="insertDB" parameterType="culturalPropertiesDTO">
        INSERT INTO cultural_properties (id, category_code, management_number, city_code, cultural_properties_name,
        category_name, region, district, dynasty, address, registration_date, classify_a, classify_b, classify_c,
        classify_d, content, main_img_url, img_url, img_desc, video_url, narration_url, longitude, latitude)
        VALUES (#{id}, #{categoryCode}, #{managementNumber}, #{cityCode}, #{culturalPropertiesName}, #{categoryName},
        #{region}, #{district}, #{dynasty}, #{address}, #{registrationDate}, #{classifyA}, #{classifyB}, #{classifyC},
        #{classifyD}, #{content}, #{mainImgUrl}, #{imgUrl}, #{imgDesc}, #{videoUrl}, #{narrationUrl}, #{longitude},
        #{latitude})
    </insert>

    <!--    <select id="selectDB" resultType="culturalPropertiesDTO">-->
    <!--        SELECT * FROM cultural_properties-->
    <!--    </select>-->

    <select id="selectDB" resultType="culturalPropertiesDTO">
        SELECT *
        FROM( SELECT ROW_NUMBER() OVER(ORDER BY id DESC) AS rownum, c.*
        FROM cultural_properties c) c2
        WHERE c2.rownum BETWEEN ${start} AND ${end}

    </select>


    <select id="selectCount" resultType="Integer">
        select count(*) from cultural_properties
    </select>

    <!--    <select id="selectCulturalProperties" resultType="culturalPropertiesDTO">-->
    <!--        SELECT * FROM cultural_properties-->
    <!--        LIMIT #{itemsPerPage} OFFSET #{offset}-->
    <!--    </select>-->


    <!--    <select id="searchCulturalProperties" resultType="culturalPropertiesDTO">-->
    <!--        SELECT *-->
    <!--        FROM cultural_properties-->
    <!--        WHERE 1=1-->
    <!--        AND (#{categoryName} IS NULL OR category_name = #{categoryName})-->
    <!--        AND (#{culturalPropertiesName} IS NULL OR cultural_properties_name LIKE CONCAT('%', #{culturalPropertiesName}, '%'))-->
    <!--        AND (#{region} IS NULL OR region = #{region})-->
    <!--        AND (#{dynasty} IS NULL OR dynasty = #{dynasty})-->
    <!--    </select>-->

    <select id="searchCulturalProperties" resultType="culturalPropertiesDTO" parameterType="culturalPropertiesDTO">

        SELECT * FROM (
            SELECT ROW_NUMBER()
                OVER(ORDER BY id DESC) AS rownum, c.*
            FROM ( SELECT * FROM cultural_properties


                <where>

                    <if test="categoryName != null and categoryName != ''">
                        AND category_name = #{categoryName}
                    </if>

                    <if test="culturalPropertiesName != null and culturalPropertiesName != ''">
                        AND cultural_properties_name LIKE CONCAT('%', #{culturalPropertiesName}, '%')
                    </if>

<!--                    <if test="region!=null and !region.equals('')">-->
<!--                        AND region LIKE CONCAT('%', #{region}, '%')-->
<!--                    </if>-->
                        AND region LIKE CONCAT('%', #{region}, '%')


<!--                    <if test="dynasty != null and dynasty != ''">-->
<!--                        AND dynasty LIKE CONCAT('%', #{dynasty}, '%')-->
<!--                    </if>-->
                </where>
                ) AS c
            ) AS c2

                WHERE c2.rownum BETWEEN #{start} AND #{end};

    </select>


</mapper>